{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/DarwinQVO/finance-app-kernel/schemas/match-candidate.schema.json",
  "title": "MatchCandidate",
  "description": "Suggested reconciliation match candidate generated by ReconciliationEngine. Contains source/target items, similarity score, feature-level scores, and decision (auto_link/suggest/manual/no_match) based on thresholds.",
  "type": "object",
  "required": [
    "candidate_id",
    "source_1_item",
    "source_2_item",
    "similarity_score",
    "feature_scores",
    "decision",
    "match_details"
  ],
  "properties": {
    "candidate_id": {
      "type": "string",
      "pattern": "^candidate_[a-z0-9_]+$",
      "description": "Unique candidate identifier. Format: 'candidate_{uuid}'. Temporary ID used until match is confirmed/rejected."
    },
    "source_1_item": {
      "type": "object",
      "description": "Item from source 1",
      "required": ["item_id", "display_text"],
      "properties": {
        "item_id": {
          "type": "string",
          "description": "Unique item identifier in source 1"
        },
        "display_text": {
          "type": "string",
          "description": "Primary display text for item (description, title, etc.)"
        },
        "amount": {
          "type": ["number", "null"],
          "description": "Amount value (if applicable to domain)"
        },
        "date": {
          "type": ["string", "null"],
          "format": "date",
          "description": "ISO date (if applicable to domain)"
        },
        "metadata": {
          "type": "object",
          "description": "Domain-specific fields (account, counterparty, reference, etc.)",
          "additionalProperties": true
        }
      }
    },
    "source_2_item": {
      "type": "object",
      "description": "Item from source 2",
      "required": ["item_id", "display_text"],
      "properties": {
        "item_id": {
          "type": "string",
          "description": "Unique item identifier in source 2"
        },
        "display_text": {
          "type": "string",
          "description": "Primary display text for item (description, title, etc.)"
        },
        "amount": {
          "type": ["number", "null"],
          "description": "Amount value (if applicable to domain)"
        },
        "date": {
          "type": ["string", "null"],
          "format": "date",
          "description": "ISO date (if applicable to domain)"
        },
        "metadata": {
          "type": "object",
          "description": "Domain-specific fields (account, counterparty, reference, etc.)",
          "additionalProperties": true
        }
      }
    },
    "similarity_score": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Overall similarity/confidence score (0.0 to 1.0). Weighted average of feature_scores. Used for decision thresholding."
    },
    "feature_scores": {
      "type": "object",
      "description": "Individual feature confidence scores. Each feature contributes to overall similarity_score based on config weights.",
      "patternProperties": {
        "^[a-z_]+_score$": {
          "type": "number",
          "minimum": 0.0,
          "maximum": 1.0,
          "description": "Feature score (0.0 to 1.0). 1.0=perfect match, 0.0=no match"
        }
      },
      "minProperties": 1,
      "additionalProperties": false
    },
    "decision": {
      "type": "string",
      "enum": ["auto_link", "suggest", "manual", "no_match"],
      "description": "Match decision based on similarity_score and thresholds. auto_link (â‰¥0.95): auto-accept, suggest (0.70-0.94): show to user, manual (0.50-0.69): allow manual override, no_match (<0.50): reject"
    },
    "match_details": {
      "type": "object",
      "description": "Match metadata: blocking key, thresholds, tolerances, field differences, etc.",
      "properties": {
        "blocking_key": {
          "type": ["string", "null"],
          "description": "Blocking key used to generate this candidate (e.g., '2024-10-15_1234.56')"
        },
        "thresholds": {
          "type": ["object", "null"],
          "properties": {
            "auto_link": {"type": "number", "minimum": 0, "maximum": 1},
            "auto_suggest": {"type": "number", "minimum": 0, "maximum": 1},
            "manual": {"type": "number", "minimum": 0, "maximum": 1}
          }
        },
        "tolerances": {
          "type": ["object", "null"],
          "properties": {
            "amount_diff": {"type": "number", "description": "Absolute amount difference"},
            "amount_percent": {"type": "number", "description": "Percentage amount difference"},
            "date_diff_days": {"type": "integer", "description": "Date difference in days"}
          }
        },
        "weights": {
          "type": ["object", "null"],
          "description": "Feature weights used to calculate similarity_score",
          "patternProperties": {
            "^[a-z_]+$": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0
            }
          }
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "candidate_id": "candidate_001",
      "source_1_item": {
        "item_id": "bank_txn_001",
        "display_text": "Payment to Vendor A",
        "amount": 1234.56,
        "date": "2024-10-15",
        "metadata": {
          "account": "Checking",
          "reference": "PAY001"
        }
      },
      "source_2_item": {
        "item_id": "ledger_entry_001",
        "display_text": "Accounts Payable - Vendor A",
        "amount": 1234.56,
        "date": "2024-10-15",
        "metadata": {
          "category": "Operating Expenses",
          "invoice": "INV-001"
        }
      },
      "similarity_score": 0.98,
      "feature_scores": {
        "amount_score": 1.0,
        "date_score": 1.0,
        "description_score": 0.95,
        "counterparty_score": 0.98
      },
      "decision": "auto_link",
      "match_details": {
        "blocking_key": "2024-10-15_1234.56",
        "thresholds": {
          "auto_link": 0.95,
          "auto_suggest": 0.70,
          "manual": 0.50
        },
        "tolerances": {
          "amount_diff": 0.0,
          "amount_percent": 0.0,
          "date_diff_days": 0
        },
        "weights": {
          "amount": 0.50,
          "date": 0.30,
          "description": 0.15,
          "counterparty": 0.05
        }
      }
    },
    {
      "candidate_id": "candidate_002",
      "source_1_item": {
        "item_id": "bank_txn_002",
        "display_text": "Utility Payment",
        "amount": 123.45,
        "date": "2024-10-14",
        "metadata": {
          "account": "Checking"
        }
      },
      "source_2_item": {
        "item_id": "ledger_entry_002",
        "display_text": "Electricity Bill Payment",
        "amount": 123.0,
        "date": "2024-10-15",
        "metadata": {
          "category": "Utilities"
        }
      },
      "similarity_score": 0.85,
      "feature_scores": {
        "amount_score": 0.90,
        "date_score": 0.80,
        "description_score": 0.95,
        "counterparty_score": 0.65
      },
      "decision": "suggest",
      "match_details": {
        "blocking_key": "2024-10_123",
        "thresholds": {
          "auto_link": 0.95,
          "auto_suggest": 0.70,
          "manual": 0.50
        },
        "tolerances": {
          "amount_diff": 0.45,
          "amount_percent": 0.36,
          "date_diff_days": 1
        },
        "weights": {
          "amount": 0.50,
          "date": 0.30,
          "description": 0.20
        }
      }
    },
    {
      "candidate_id": "candidate_003",
      "source_1_item": {
        "item_id": "bank_txn_003",
        "display_text": "Misc Expense",
        "amount": 45.0,
        "date": "2024-10-10",
        "metadata": {
          "account": "Credit Card"
        }
      },
      "source_2_item": {
        "item_id": "ledger_entry_003",
        "display_text": "Office Supplies",
        "amount": 52.0,
        "date": "2024-10-12",
        "metadata": {
          "category": "Office"
        }
      },
      "similarity_score": 0.62,
      "feature_scores": {
        "amount_score": 0.75,
        "date_score": 0.60,
        "description_score": 0.50,
        "counterparty_score": 0.40
      },
      "decision": "manual",
      "match_details": {
        "blocking_key": "2024-10_45-52",
        "thresholds": {
          "auto_link": 0.95,
          "auto_suggest": 0.70,
          "manual": 0.50
        },
        "tolerances": {
          "amount_diff": 7.0,
          "amount_percent": 15.56,
          "date_diff_days": 2
        },
        "weights": {
          "amount": 0.50,
          "date": 0.30,
          "description": 0.20
        }
      }
    }
  ]
}
