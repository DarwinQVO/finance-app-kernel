{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://truthconstructionprimitives.org/schemas/parser-execution-metric.schema.json",
  "title": "ParserExecutionMetric",
  "description": "Metric record for a single parser execution, tracking performance, success/failure, and extracted observations",
  "type": "object",
  "required": [
    "id",
    "parser_id",
    "upload_id",
    "started_at",
    "completed_at",
    "duration_ms",
    "status",
    "created_at"
  ],
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this metric record",
      "examples": ["pem_123e4567-e89b-12d3-a456-426614174000"]
    },
    "parser_id": {
      "type": "string",
      "maxLength": 255,
      "description": "Identifier for the parser that executed (e.g., 'bofa_pdf_v2', 'chase_csv_v1')",
      "examples": ["bofa_pdf_v2", "chase_csv_v1", "wells_fargo_ofx_v3"]
    },
    "upload_id": {
      "type": "string",
      "maxLength": 255,
      "description": "Identifier for the uploaded document that was parsed",
      "examples": ["upl_abc123def456"]
    },
    "started_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when parser execution started (UTC)",
      "examples": ["2025-10-25T10:00:00Z"]
    },
    "completed_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when parser execution completed (UTC). Null if still running or timed out.",
      "examples": ["2025-10-25T10:00:12Z"]
    },
    "duration_ms": {
      "type": "integer",
      "minimum": 0,
      "description": "Execution duration in milliseconds (completed_at - started_at)",
      "examples": [12000, 5420, 28750]
    },
    "status": {
      "type": "string",
      "enum": ["success", "error", "timeout", "empty_document"],
      "description": "Outcome of parser execution. 'empty_document' means parser succeeded but extracted 0 observations (valid for blank PDFs).",
      "examples": ["success"]
    },
    "observations_extracted": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of observations extracted from the document (null if status=error)",
      "examples": [47, 0, 123]
    },
    "pages_processed": {
      "type": "integer",
      "minimum": 0,
      "description": "Number of pages processed (applicable to PDF parsers, null for CSV/JSON)",
      "examples": [3, 12, 1]
    },
    "document_size_bytes": {
      "type": "integer",
      "minimum": 0,
      "description": "Size of uploaded document in bytes",
      "examples": [2458624, 1048576, 524288]
    },
    "error_type": {
      "type": "string",
      "maxLength": 100,
      "description": "Type of error if status=error (null if success). Common values: 'pdf_corrupted', 'timeout', 'out_of_memory', 'invalid_format', 'missing_columns'.",
      "examples": ["pdf_corrupted", "timeout", "invalid_format"]
    },
    "error_message": {
      "type": "string",
      "description": "Detailed error message if status=error (null if success). May contain stack trace snippets.",
      "examples": ["Failed to parse PDF: Invalid object at byte offset 12345"]
    },
    "metadata": {
      "type": "object",
      "description": "Additional parser-specific metadata (optional)",
      "properties": {
        "pdf_version": {
          "type": "string",
          "description": "PDF version if applicable (e.g., '1.7')",
          "examples": ["1.7", "1.4"]
        },
        "encoding": {
          "type": "string",
          "description": "Document encoding detected (e.g., 'UTF-8', 'ISO-8859-1')",
          "examples": ["UTF-8", "ISO-8859-1"]
        },
        "parser_version": {
          "type": "string",
          "description": "Semantic version of parser used (e.g., 'v2.1.0')",
          "examples": ["v2.1.0", "v1.3.2"]
        },
        "confidence_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Parser confidence in extraction quality (0-1)",
          "examples": [0.98, 0.75]
        }
      },
      "additionalProperties": true
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when this metric record was created (UTC)",
      "examples": ["2025-10-25T10:00:13Z"]
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "id": "pem_123e4567-e89b-12d3-a456-426614174000",
      "parser_id": "bofa_pdf_v2",
      "upload_id": "upl_abc123def456",
      "started_at": "2025-10-25T10:00:00Z",
      "completed_at": "2025-10-25T10:00:12Z",
      "duration_ms": 12000,
      "status": "success",
      "observations_extracted": 47,
      "pages_processed": 3,
      "document_size_bytes": 2458624,
      "error_type": null,
      "error_message": null,
      "metadata": {
        "pdf_version": "1.7",
        "parser_version": "v2.1.0",
        "confidence_score": 0.98
      },
      "created_at": "2025-10-25T10:00:13Z"
    },
    {
      "id": "pem_987f6543-e21b-34d5-b654-321098765432",
      "parser_id": "chase_csv_v1",
      "upload_id": "upl_xyz789ghi012",
      "started_at": "2025-10-25T11:30:00Z",
      "completed_at": "2025-10-25T11:30:02Z",
      "duration_ms": 2150,
      "status": "error",
      "observations_extracted": null,
      "pages_processed": null,
      "document_size_bytes": 524288,
      "error_type": "invalid_format",
      "error_message": "CSV missing required column 'Transaction Date'",
      "metadata": {
        "encoding": "UTF-8",
        "parser_version": "v1.3.2"
      },
      "created_at": "2025-10-25T11:30:02Z"
    },
    {
      "id": "pem_456a7890-b12c-45d6-e789-012345678901",
      "parser_id": "wells_fargo_ofx_v3",
      "upload_id": "upl_mno345pqr678",
      "started_at": "2025-10-25T14:15:00Z",
      "completed_at": "2025-10-25T14:15:01Z",
      "duration_ms": 1280,
      "status": "empty_document",
      "observations_extracted": 0,
      "pages_processed": null,
      "document_size_bytes": 8192,
      "error_type": null,
      "error_message": null,
      "metadata": {
        "parser_version": "v3.0.1",
        "confidence_score": 1.0
      },
      "created_at": "2025-10-25T14:15:01Z"
    }
  ]
}
