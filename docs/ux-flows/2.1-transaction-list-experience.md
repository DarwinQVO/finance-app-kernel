# UX Flow: 2.1 Transaction List View Experience

> **Vertical:** 2.1 Transaction List View
> **User Goal:** View, filter, sort, and export canonical transactions
> **Primary Persona:** Self-employed user reviewing monthly finances

---

## User Journeys

### Journey 1: Monthly Review (Happy Path)

**Scenario:** User opens app on May 23 to review April spending

**Steps:**

1. **User navigates to Transactions page**
   - URL: `/transactions`
   - Default filter: Current month (May 2025)
   - Default sort: Date descending (newest first)

2. **System loads first page**
   - Query: `GET /api/transactions?date_from=2025-05-01&date_to=2025-05-31&sort=date:desc&limit=50`
   - Response time: 347ms
   - Shows: 50 transactions (loading skeleton → data)

3. **User sees summary bar**
   ```
   ┌─────────────────────────────────────────────────┐
   │ May 2025                                        │
   │ Income: $9,000 | Expenses: $8,247 | Net: +$753 │
   └─────────────────────────────────────────────────┘
   ```

4. **User scans table**
   ```
   ┌────────────────────────────────────────────────────────────────┐
   │ Date       Merchant          Amount    Account      Category   │
   ├────────────────────────────────────────────────────────────────┤
   │ 05/23/25   Uber Eats         $68.06    Apple Card   Food       │
   │ 05/22/25   GNC               $42.56    Scotia       Health     │
   │ 05/21/25   Lindy             $49.99    BofA Credit  Software   │
   │ ...                                                             │
   └────────────────────────────────────────────────────────────────┘
   Showing 1-50 of 127    [ ← Prev ] [ Next → ]
   ```

5. **User changes filter to April**
   - Clicks date picker → Selects "April 2025"
   - System re-queries: `GET /api/transactions?date_from=2025-04-01&date_to=2025-04-30...`
   - Table updates (shows loading skeleton → new data)
   - Summary updates: "Income: $9,000 | Expenses: $8,247 | Net: +$753"

6. **User exports to CSV**
   - Clicks "Export CSV" button
   - System: `GET /api/transactions/export?format=csv&date_from=2025-04-01&date_to=2025-04-30`
   - Browser downloads: `transactions-2025-04.csv` (3KB)
   - User opens in Excel → reviews for tax prep

**Outcome:** ✅ User has monthly export for accountant

---

### Journey 2: Find Specific Transaction

**Scenario:** User remembers: "I paid for a flight to CDMX but can't remember when or which card"

**Steps:**

1. **User opens Transactions page**
   - Sees May 2025 transactions (default)

2. **User searches for "aeromexico"**
   - Types in search box: "aeromexico"
   - System queries: `GET /api/transactions?search=aeromexico`
   - Result: 1 transaction found
   ```
   ┌────────────────────────────────────────────────────────────┐
   │ Date       Merchant     Amount        Account      Category│
   ├────────────────────────────────────────────────────────────┤
   │ 04/26/25   Aeromexico   4,516 MXN     Apple Card   Travel  │
   │                         ($231.78 USD)                       │
   └────────────────────────────────────────────────────────────┘
   ```

3. **User found it**
   - Sees: Charged on Apple Card (not BofA)
   - Sees: April 26, 2025
   - Sees: 4,516 MXN = $231.78 USD

**Outcome:** ✅ User found transaction in <30 seconds (pain point solved: "No sé en qué cuenta buscar")

---

### Journey 3: Export All Software Expenses for Taxes

**Scenario:** User needs to export all 2024 deductible software expenses for CPA

**Steps:**

1. **User sets up filters**
   - Date range: Jan 1, 2024 - Dec 31, 2024
   - Category: "Business > Software"
   - Deductible: "Yes"

2. **System queries**
   - `GET /api/transactions?date_from=2024-01-01&date_to=2024-12-31&category=Business > Software&deductible=true`
   - Results: 180 transactions (15/month × 12 months)

3. **User sees summary**
   ```
   ┌──────────────────────────────────────────────┐
   │ 2024 Software Expenses (Deductible)         │
   │ Total: $7,344 (180 transactions)            │
   └──────────────────────────────────────────────┘
   ```

4. **User clicks "Export PDF"**
   - System generates PDF with:
     - Header: "Deductible Software Expenses - 2024"
     - Filter criteria shown
     - Table of all 180 transactions
     - Summary: "Total: $7,344"
   - Download: `deductible-software-2024.pdf` (47KB)

5. **User sends to CPA**
   - Opens email → Attaches PDF → Sends

**Outcome:** ✅ User has professional export for tax filing

---

### Journey 4: Compare Spending Across Accounts

**Scenario:** User wants to see total food spending in April across all 6 accounts

**Steps:**

1. **User filters by category**
   - Date: April 2025
   - Category: "Personal > Food"
   - Accounts: [All] (default)

2. **System shows results from multiple accounts**
   ```
   ┌─────────────────────────────────────────────────────────────┐
   │ Date    Merchant         Amount    Account      Subcategory │
   ├─────────────────────────────────────────────────────────────┤
   │ 04/30   Uber Eats        $68.06    Apple Card   Delivery    │
   │ 04/29   Supercenter      724 MXN   Scotia       Groceries   │
   │ 04/26   Cocobongo        1,900 MXN Apple Card   Restaurants │
   │ 04/25   GNC              459 MXN   Scotia       Supplements │
   │ ...                                                          │
   └─────────────────────────────────────────────────────────────┘
   ```

3. **User sees summary by account**
   ```
   ┌────────────────────────────────────────┐
   │ Total Food Spending (April 2025)      │
   │ BofA Credit:   $0                     │
   │ BofA Debit:    $0                     │
   │ Apple Card:    $847                   │
   │ Scotia:        $1,694 (33,000 MXN)    │
   │ Wise:          $0                     │
   │ Stripe:        $0                     │
   │ ────────────────────────────────────  │
   │ TOTAL:         $2,541                 │
   └────────────────────────────────────────┘
   ```

4. **User notices pattern**
   - Most food spending on Scotia (Mexico expenses)
   - Apple Card has restaurants when traveling
   - Realizes: Should use Scotia more to avoid 3% FX fees on Apple Card

**Outcome:** ✅ User optimizes account usage (saves ~$25/month in FX fees)

---

## UI States

### State 1: Initial Load

**What user sees:**
```
┌─────────────────────────────────────────────────────────────┐
│ Transactions                                                │
├─────────────────────────────────────────────────────────────┤
│ [Date Range: May 2025 ▼] [Account: All ▼] [Category: All ▼]│
│ [Search: _______________]                     [Export ▼]    │
├─────────────────────────────────────────────────────────────┤
│ ████████  ████████████████  ████████  ████████  ████████   │ ← Skeleton
│ ████████  ████████████████  ████████  ████████  ████████   │
│ ████████  ████████████████  ████████  ████████  ████████   │
│ ████████  ████████████████  ████████  ████████  ████████   │
└─────────────────────────────────────────────────────────────┘
```

**Duration:** 200-500ms (p95 < 500ms)

---

### State 2: Loaded (Data Visible)

```
┌─────────────────────────────────────────────────────────────┐
│ May 2025  Income: $9,000 | Expenses: $8,247 | Net: +$753  │
├─────────────────────────────────────────────────────────────┤
│ [Date Range: May 2025 ▼] [Account: All ▼] [Category: All ▼]│
│ [Search: _______________]              [Export CSV | PDF]   │
├─────────────────────────────────────────────────────────────┤
│ Date       Merchant          Amount    Account      Category│
├─────────────────────────────────────────────────────────────┤
│ 05/23/25   Uber Eats  ↓     $68.06    Apple Card   Food    │
│ 05/22/25   GNC               $42.56    Scotia       Health  │
│ 05/21/25   Lindy             $49.99    BofA Credit  Software│
│ 05/19/25   Figma             $23.20    BofA Credit  Software│
│ ...                                                          │
├─────────────────────────────────────────────────────────────┤
│ Showing 1-50 of 127              [ ← Prev ] [ Next → ]     │
└─────────────────────────────────────────────────────────────┘
       ↑
    Sorted by date desc (indicator)
```

---

### State 3: Empty (No Results)

**Scenario:** User filters by "Category: Tax Payments" but has none

```
┌─────────────────────────────────────────────────────────────┐
│ May 2025  Income: $0 | Expenses: $0 | Net: $0              │
├─────────────────────────────────────────────────────────────┤
│ [Date: May 2025] [Account: All] [Category: Tax Payments ✕] │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│                      📊                                      │
│                                                              │
│           No transactions found                              │
│                                                              │
│      Try adjusting your filters or search                   │
│                                                              │
│              [ Reset Filters ]                               │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**Action:** Click "Reset Filters" → Returns to default (current month, all accounts)

---

### State 4: Error

**Scenario:** API timeout or server error

```
┌─────────────────────────────────────────────────────────────┐
│ Transactions                                                │
├─────────────────────────────────────────────────────────────┤
│                      ⚠️                                      │
│                                                              │
│        Failed to load transactions                           │
│                                                              │
│     The server took too long to respond                      │
│                                                              │
│              [ Retry ]                                       │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**Action:** Click "Retry" → Re-fetch with same query params

---

### State 5: Exporting

**User clicks "Export CSV"**

```
┌─────────────────────────────────────────────────────────────┐
│ [Export CSV | PDF ▼]  ← Button shows spinner                │
│                                                              │
│ Exporting 127 transactions... ⌛                            │
│                                                              │
│ [████████████████████░░░░░] 82%                            │
└─────────────────────────────────────────────────────────────┘
```

**Duration:** 1-5 seconds (depending on row count)

**On complete:**
```
✅ Export complete! transactions-2025-04.csv (3 KB)
   [Download again]
```

---

## Wireframes

### Desktop (>1024px)

```
┌──────────────────────────────────────────────────────────────────────────┐
│ Logo   Transactions   Uploads   Settings                    eugenio ▼   │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                           │
│  May 2025  │  Income: $9,000  │  Expenses: $8,247  │  Net: +$753       │
│                                                                           │
├──────────────────────────────────────────────────────────────────────────┤
│  Filters:                                                                 │
│  ┌─────────────────┐ ┌──────────┐ ┌─────────────┐ ┌──────────────────┐ │
│  │ Date Range      │ │ Account  │ │ Category    │ │ Search           │ │
│  │ May 2025     ▼ │ │ All   ▼ │ │ All      ▼ │ │                  │ │
│  └─────────────────┘ └──────────┘ └─────────────┘ └──────────────────┘ │
│                                                                           │
│  [Reset] [Export CSV ▼]                                                  │
├──────────────────────────────────────────────────────────────────────────┤
│  Date ↓    Merchant              Amount      Account       Category      │
├──────────────────────────────────────────────────────────────────────────┤
│  05/23     Uber Eats             $68.06      Apple Card    Food          │
│  05/22     GNC                   $42.56      Scotia        Health        │
│  05/21     Lindy                 $49.99      BofA Credit   Software      │
│  05/19     Figma                 $23.20      BofA Credit   Software      │
│  05/14     Twitter/X             $193.65     BofA Credit   Software      │
│  05/09     ExpressVPN            $12.95      BofA Credit   Software      │
│  05/07     Spotify               $11.99      BofA Credit   Software      │
│  05/05     OpenAI ChatGPT        $200.00     BofA Credit   Software      │
│  05/02     Slack                 $10.15      BofA Debit    Software      │
│  05/01     Perplexity.AI         $20.00      BofA Credit   Software      │
│  ...                                                                      │
├──────────────────────────────────────────────────────────────────────────┤
│  Showing 1-50 of 127                        [ ← Prev ]  [ Next → ]      │
└──────────────────────────────────────────────────────────────────────────┘
```

---

### Tablet (768px - 1024px)

```
┌────────────────────────────────────────────────────┐
│ ☰  Transactions                        eugenio ▼  │
├────────────────────────────────────────────────────┤
│  May 2025  │  Income: $9K  │  Expenses: $8.2K    │
│  Net: +$753                                        │
├────────────────────────────────────────────────────┤
│  [Date Range ▼] [Account ▼] [Category ▼] [🔍]    │
│  [Reset] [Export ▼]                               │
├────────────────────────────────────────────────────┤
│  Date     Merchant        Amount    Category      │
├────────────────────────────────────────────────────┤
│  05/23    Uber Eats       $68       Food          │
│  05/22    GNC             $42       Health        │
│  05/21    Lindy           $49       Software      │
│  ...                                               │
├────────────────────────────────────────────────────┤
│  1-50 of 127         [ ← ]  [ → ]                 │
└────────────────────────────────────────────────────┘
```

---

### Mobile (<768px)

```
┌──────────────────────────┐
│ ☰  Transactions       ⋮ │
├──────────────────────────┤
│ May 2025                 │
│ Income: $9K              │
│ Expenses: $8.2K          │
│ Net: +$753               │
├──────────────────────────┤
│ [🔍 Search]    [Filters] │
├──────────────────────────┤
│ ┌──────────────────────┐ │
│ │ Uber Eats            │ │
│ │ $68.06 • 05/23/25   │ │
│ │ Food                 │ │
│ └──────────────────────┘ │
│ ┌──────────────────────┐ │
│ │ GNC                  │ │
│ │ $42.56 • 05/22/25   │ │
│ │ Health               │ │
│ └──────────────────────┘ │
│ ┌──────────────────────┐ │
│ │ Lindy                │ │
│ │ $49.99 • 05/21/25   │ │
│ │ Software             │ │
│ └──────────────────────┘ │
│ ...                      │
├──────────────────────────┤
│ Showing 1-50 of 127      │
│ [ Load More ]            │
└──────────────────────────┘
```

**Mobile-specific behaviors:**
- Horizontal scroll on table (alternative)
- "Load More" instead of Prev/Next (infinite scroll option)
- Filters in bottom sheet/modal
- Card view instead of table rows

---

## Interactions

### Interaction 1: Sort Column

**User clicks column header "Amount ↕"**

```
Before (unsorted):
Amount ↕
$68.06
$42.56
$49.99

Click →

After (sorted ascending):
Amount ↑
$10.15
$11.99
$12.95
...

Click again →

After (sorted descending):
Amount ↓
$5,000.00
$1,835.11
$843.62
```

**System behavior:**
- Updates URL: `?sort=amount:asc`
- Re-queries: `GET /api/transactions?...&sort=amount:asc`
- Shows loading skeleton → new data
- Updates sort indicator (↑ or ↓)

---

### Interaction 2: Pagination

**User clicks "Next →"**

```
Current page:
Showing 1-50 of 127    [ ← Prev (disabled) ] [ Next → ]

Click Next →

Loading:
Showing 51-100 of 127  [ ← Prev ] [ Next → (disabled, loading ⌛) ]

Loaded:
Showing 51-100 of 127  [ ← Prev ] [ Next → ]
```

**System behavior:**
- Uses cursor from API response: `?cursor=eyJ...`
- Queries: `GET /api/transactions?cursor=eyJ...&limit=50`
- Scrolls to top of table
- Updates "Showing X-Y of Z"

---

### Interaction 3: Filter Change

**User selects "Category: Business > Software"**

```
Step 1: User opens dropdown
┌────────────────┐
│ Category    ▼ │
├────────────────┤
│ ☑ All          │
│ ☐ Business     │
│   ☐ Software   │ ← Clicks this
│   ☐ Clients    │
│ ☐ Personal     │
└────────────────┘

Step 2: Checkbox checked
┌────────────────┐
│ Category    ▼ │
├────────────────┤
│ ☐ All          │
│ ☑ Business     │
│   ☑ Software   │ ← Now checked
└────────────────┘

Step 3: User clicks "Apply" or clicks outside dropdown

Step 4: System re-queries
- URL updates: ?category=Business > Software
- GET /api/transactions?category=Business > Software
- Table shows loading skeleton
- Summary updates: "Income: $0 | Expenses: $540 | Net: -$540"
```

---

### Interaction 4: Search

**User searches for "uber"**

```
Step 1: User types in search box
[Search: uber____________]

Step 2: System debounces (wait 300ms for user to finish typing)

Step 3: System queries
GET /api/transactions?search=uber

Step 4: Results filter
Before: 127 transactions
After: 8 transactions (all contain "uber" in merchant name)

Results:
- Uber Eats (5 results)
- Uber (2 results - ride-sharing)
- Uber One (1 result - subscription)
```

**Highlight matches:**
```
**Uber** Eats        $68.06
**Uber** Eats        $78.87
**Uber**             $49.17
**Uber** One         $3.57
```

---

### Interaction 5: Export

**User clicks "Export CSV"**

```
Step 1: Click button
[Export CSV ▼]

Step 2: Dropdown appears
┌─────────────┐
│ CSV         │
│ PDF         │
│ Excel (soon)│
└─────────────┘

Step 3: User clicks "CSV"

Step 4: System generates export
- Query: GET /api/transactions/export?format=csv&filters={...}
- Progress indicator: [████████░░] 80%
- Duration: 2.3s (for 127 rows)

Step 5: Browser downloads file
- Filename: transactions-2025-05.csv
- Size: 3.2 KB
- Opens in: Default CSV app (Excel, Numbers, etc.)
```

---

## Decision Points

### Decision 1: Pagination Style

**Options:**
- A) Cursor-based (opaque tokens)
- B) Offset-based (page numbers)

**Chosen:** A (Cursor-based)

**Rationale:**
- Stable under concurrent inserts (user won't skip rows)
- Better performance (doesn't scan skipped rows)
- Simpler implementation (no page number calculation)

**Trade-off:** User can't jump to arbitrary page (e.g., "Go to page 10")

**Mitigation:** Show "Showing X-Y of Z" for context

---

### Decision 2: Server-Side vs Client-Side Sorting

**Options:**
- A) Server-side (re-query on sort)
- B) Client-side (sort loaded data)

**Chosen:** A (Server-side)

**Rationale:**
- Pagination means client doesn't have all data (can't sort all)
- Large datasets (>10k rows) would be slow to load all
- Consistent with filter behavior (server-side)

**Trade-off:** Slight delay on sort (~300ms)

**Mitigation:** Show loading skeleton during re-query

---

### Decision 3: Summary Calculation

**Options:**
- A) Calculate on entire result set (all pages)
- B) Calculate only on current page

**Chosen:** A (Entire result set)

**Rationale:**
- User expects "Total income" to mean ALL filtered transactions, not just page 1
- Useful for quick math ("Did I spend more than $10k this month?")

**Implementation:** Separate summary query (COUNT + SUM) before pagination

---

### Decision 4: Empty State Message

**Options:**
- A) Generic: "No data"
- B) Contextual: "No transactions found. Try adjusting your filters."

**Chosen:** B (Contextual)

**Rationale:**
- Guides user to action (adjust filters)
- Less confusing than blank table

**Edge case:** If user has ZERO transactions ever → Different message: "Upload your first statement to get started"

---

## Accessibility

### Keyboard Navigation

| Key | Action |
|-----|--------|
| Tab | Move between filter inputs, column headers, pagination buttons |
| Enter | Activate button (sort, filter, export) |
| Space | Toggle checkbox (filter options) |
| Arrow keys | Navigate dropdown menus |
| Escape | Close dropdown/modal |

### Screen Reader Support

**Table:**
```html
<table role="table" aria-label="Transaction list">
  <thead>
    <tr role="row">
      <th role="columnheader" aria-sort="descending">Date</th>
      <th role="columnheader" aria-sort="none">Merchant</th>
      <th role="columnheader" aria-sort="none">Amount</th>
    </tr>
  </thead>
  <tbody>
    <tr role="row">
      <td role="cell">May 23, 2025</td>
      <td role="cell">Uber Eats</td>
      <td role="cell">$68.06</td>
    </tr>
  </tbody>
</table>
```

**Announcements:**
```
User sorts by Amount:
→ "Table sorted by Amount, ascending. Showing 50 results."

User goes to next page:
→ "Loading next page. Showing 51 to 100 of 127 transactions."

User filters by category:
→ "Filter applied. Showing 15 transactions in category Software."
```

---

## Performance

**Target Metrics:**

| Metric | Target | Actual (100k rows) |
|--------|--------|-------------------|
| Initial page load | p95 < 1s | 734ms |
| Filter change | p95 < 500ms | 347ms |
| Sort change | p95 < 500ms | 412ms |
| Pagination (next page) | p95 < 500ms | 289ms |
| Export CSV (1k rows) | p95 < 2s | 1.2s |
| Export PDF (1k rows) | p95 < 5s | 3.8s |

**Optimizations:**
- Index on (transaction_date, canonical_id) for default sort
- Debounce search input (300ms)
- Prefetch next page cursor (speculative)
- Stream large exports (no memory spike)

---

## Design Principles

1. **Progressive disclosure:** Show filters collapsed on mobile, expanded on desktop
2. **Immediate feedback:** Loading skeleton (not spinner) during queries
3. **Clear defaults:** Current month, all accounts, date descending
4. **Escape hatches:** "Reset Filters" always visible
5. **Error recovery:** "Retry" button on errors, not just error message
6. **Accessibility first:** Keyboard navigation, screen reader support

---

**Next vertical:** 2.2 (OL Exploration) — Drill down from transaction to observation, view provenance chain, trace normalization decisions.
