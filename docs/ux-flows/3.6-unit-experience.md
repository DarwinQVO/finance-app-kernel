# UX Flow: 3.6 Unit (Currency & Date Normalization)

> **Vertical:** 3.6 Unit (Currency & Date Normalization)
> **Pattern:** Value Normalization + Unit Conversion + Context Preservation
> **Last Updated:** 2025-10-24

---

## Overview

This document describes the end-to-end user experience for currency and date normalization across 6 key user journeys. Each journey includes step-by-step flows, UI wireframes, error handling, and multi-domain examples.

**Covered Journeys:**
1. Set base currency (first-time setup)
2. View transaction in original + normalized currencies
3. Refresh stale exchange rate
4. Manual rate override
5. Change timezone
6. View historical rate

---

## Journey 1: Set Base Currency (First-Time Setup)

### User Goal
User wants to set their base currency during onboarding so all transactions are normalized to their preferred currency.

### Entry Point
- **Onboarding flow** (new user account)
- **Settings page** (existing user changing base currency)

### User Flow

```
Step 1: User opens onboarding wizard
  â†“
Step 2: System shows "Choose Your Base Currency" screen
  â†“
Step 3: User sees CurrencySelectorDialog with popular currencies first
  â†“
Step 4: User searches "mex" â†’ filters to "MXN - Mexican Peso"
  â†“
Step 5: User selects "MXN - Mexican Peso"
  â†“
Step 6: System prompts for timezone (auto-detected: America/Mexico_City)
  â†“
Step 7: User confirms timezone
  â†“
Step 8: System prompts for display locale (auto-detected: es-MX)
  â†“
Step 9: User confirms locale
  â†“
Step 10: System creates CurrencyConfig record
  â†“
Step 11: User sees confirmation: "âœ… Base currency set to MXN"
  â†“
Step 12: Onboarding proceeds to next step
```

### Wireframe: Base Currency Selection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Welcome to Finance App                         Ã— â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Step 1 of 3: Choose Your Base Currency           â”‚
â”‚                                                    â”‚
â”‚  All transactions will be converted to this        â”‚
â”‚  currency for easy tracking and reporting.         â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ðŸ” Search currencies...                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  âœ¨ Popular Currencies                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸ‡ºðŸ‡¸ USD - US Dollar                         â”‚ â”‚
â”‚  â”‚ ðŸ‡ªðŸ‡º EUR - Euro                              â”‚ â”‚
â”‚  â”‚ ðŸ‡²ðŸ‡½ MXN - Mexican Peso                      â”‚ â”‚
â”‚  â”‚ ðŸ‡¬ðŸ‡§ GBP - British Pound                     â”‚ â”‚
â”‚  â”‚ ðŸ‡¯ðŸ‡µ JPY - Japanese Yen                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  All Currencies (A-Z) â–¼                            â”‚
â”‚                                                    â”‚
â”‚                        [Back]  [Continue]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Wireframe: Timezone Confirmation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Welcome to Finance App                         Ã— â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Step 2 of 3: Confirm Your Timezone               â”‚
â”‚                                                    â”‚
â”‚  We'll use this to display transaction dates       â”‚
â”‚  in your local time.                               â”‚
â”‚                                                    â”‚
â”‚  Detected Timezone:                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸŒŽ America/Mexico_City (GMT-6)              â”‚ â”‚
â”‚  â”‚    Currently: Nov 1, 2024 10:00 AM          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  [Change Timezone]                                 â”‚
â”‚                                                    â”‚
â”‚                        [Back]  [Continue]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Error Handling

**Error 1: Invalid Currency Selection**
- **Trigger:** User somehow selects invalid currency (edge case)
- **Message:** "âŒ Invalid currency. Please select from the list."
- **Recovery:** Show CurrencySelectorDialog again

**Error 2: Network Failure During Config Save**
- **Trigger:** API call fails to save CurrencyConfig
- **Message:** "âš ï¸ Failed to save settings. Please try again."
- **Recovery:** Retry button, auto-retry after 3 seconds

---

## Journey 2: View Transaction in Original + Normalized Currencies

### User Goal
User wants to see transaction amount in both the original currency (from credit card statement) and their base currency (for total tracking).

### Entry Point
- **Transaction List** (main app view)
- **Transaction Detail** (drill-down panel)

### User Flow

```
Step 1: User imports transactions from bank (includes $100 USD expense)
  â†“
Step 2: System normalizes transaction:
  - Calls CurrencyConverter.convert(100, "USD", "MXN", date)
  - Fetches rate from ExchangeRateProvider (18.5000)
  - Creates NormalizedAmount (normalized: $1,850 MXN)
  â†“
Step 3: User views TransactionList
  â†“
Step 4: User sees AmountDisplayCard showing:
  - Primary: "$1,850.00 MXN" (large, bold)
  - Secondary: "($100.00 USD @ 18.50)" (small, gray)
  â†“
Step 5: User clicks transaction to view detail
  â†“
Step 6: DrillDownPanel shows:
  - Amount section with AmountDisplayCard (dual currency)
  - ExchangeRateWidget showing rate metadata (ECB, Nov 1, 2024)
  â†“
Step 7: User hovers over rate info icon (â“˜)
  â†“
Step 8: Tooltip shows: "Rate: 18.5000 | Source: ECB | Date: Nov 1, 2024"
```

### Wireframe: Transaction List (Dual Currency)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Transactions                            [+ Add]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Nov 1, 2024                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸª Amazon                                    â”‚ â”‚
â”‚  â”‚ Groceries                                    â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚ $1,850.00 MXN                               â”‚ â”‚ â† Normalized
â”‚  â”‚ ($100.00 USD @ 18.50) â“˜                     â”‚ â”‚ â† Original + rate
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸš• Uber                                      â”‚ â”‚
â”‚  â”‚ Transportation                               â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚ $555.00 MXN                                 â”‚ â”‚
â”‚  â”‚ ($30.00 USD @ 18.50) â“˜                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Wireframe: Transaction Detail (Detailed View)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Amazon Purchase                              [âœ•]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Amount                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ $1,850.00 MXN                               â”‚ â”‚ â† Normalized (large)
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚ Original: $100.00 USD                       â”‚ â”‚
â”‚  â”‚ Rate: 18.5000 (ECB, Nov 1, 2024)           â”‚ â”‚
â”‚  â”‚ Source: European Central Bank               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  Exchange Rate Details                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1 USD = 18.5000 MXN                         â”‚ â”‚
â”‚  â”‚ ðŸ“Š ECB â”‚ Nov 1, 2024 â”‚ Updated 2h ago      â”‚ â”‚
â”‚  â”‚                                  [ðŸ”„ Refresh]â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  Date: Nov 1, 2024 10:00 AM                       â”‚
â”‚  Category: Groceries                               â”‚
â”‚  Merchant: Amazon                                  â”‚
â”‚                                                    â”‚
â”‚                        [Edit]  [Delete]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Multi-Domain Examples

**Healthcare:**
```
Medical Claim (International)
- Original: â‚¬5,000.00 EUR
- Converted: $5,250.00 USD
- Rate: 1.0500 (ECB, Nov 1, 2024)
```

**E-commerce:**
```
Product Price
- Display: $1,849.81 MXN
- Original: $99.99 USD
- Rate: 18.5000 (ECB, today)
```

---

## Journey 3: Refresh Stale Exchange Rate

### User Goal
User notices exchange rate is >24h old and wants to refresh it to get the latest rate.

### Entry Point
- **Transaction Detail** (ExchangeRateWidget shows "âš ï¸ Stale")
- **Settings > Exchange Rates** (bulk refresh)

### User Flow

```
Step 1: User views transaction from 2 days ago
  â†“
Step 2: ExchangeRateWidget shows:
  - "âš ï¸ Rate is stale (fetched 25h ago)"
  - Refresh button highlighted/pulsing
  â†“
Step 3: User clicks [ðŸ”„ Refresh] button
  â†“
Step 4: System shows loading state: "â³ Refreshing rate from ECB..."
  â†“
Step 5: ExchangeRateProvider.refresh_cache() called:
  - Invalidates cache entry
  - Fetches fresh rate from ECB API
  - New rate: 18.7500 (rate changed!)
  â†“
Step 6: System asks: "Update all transactions using old rate?"
  - Option A: "Update all USDâ†’MXN transactions from Oct 31"
  - Option B: "Only this transaction"
  â†“
Step 7: User selects Option A (batch update)
  â†“
Step 8: System re-normalizes 15 transactions:
  - Old: $100 Ã— 18.5000 = $1,850 MXN
  - New: $100 Ã— 18.7500 = $1,875 MXN
  â†“
Step 9: User sees confirmation: "âœ… Rate updated. 15 transactions recalculated."
  â†“
Step 10: ExchangeRateWidget now shows:
  - "1 USD = 18.7500 MXN"
  - "Updated just now"
  - No stale warning
```

### Wireframe: Stale Rate Warning

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Exchange Rate                              âš ï¸     â”‚  â† Stale indicator
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  1 USD = 18.5000 MXN                              â”‚
â”‚                                                    â”‚
â”‚  ðŸ“Š ECB â”‚ Oct 31, 2024 â”‚ Updated 25h ago          â”‚  â† Old date
â”‚  âš ï¸ Rate is stale - consider refreshing           â”‚  â† Warning
â”‚                                                    â”‚
â”‚                                  [ðŸ”„ Refresh] â†    â”‚  â† Highlighted
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Wireframe: Batch Update Confirmation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update Exchange Rate                           Ã— â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Rate has changed:                                 â”‚
â”‚  â€¢ Old: 1 USD = 18.5000 MXN                       â”‚
â”‚  â€¢ New: 1 USD = 18.7500 MXN                       â”‚
â”‚                                                    â”‚
â”‚  This affects 15 transactions.                     â”‚
â”‚                                                    â”‚
â”‚  What would you like to do?                        â”‚
â”‚                                                    â”‚
â”‚  â—‹ Update all 15 transactions                     â”‚
â”‚    (Recommended for accuracy)                      â”‚
â”‚                                                    â”‚
â”‚  â—‹ Only update this transaction                   â”‚
â”‚    (Others keep old rate)                          â”‚
â”‚                                                    â”‚
â”‚                        [Cancel]  [Update]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Journey 4: Manual Rate Override

### User Goal
User wants to override the system exchange rate because their bank charged a different rate (e.g., foreign transaction fee).

### Entry Point
- **Transaction Detail** (ExchangeRateWidget â†’ [âœï¸ Edit] button)

### User Flow

```
Step 1: User views transaction: $100 USD â†’ $1,850 MXN (@ 18.50)
  â†“
Step 2: User thinks: "But my bank charged me 19.00, not 18.50!"
  â†“
Step 3: User clicks [âœï¸ Edit Rate] in ExchangeRateWidget
  â†“
Step 4: Manual Override Dialog appears:
  - Current Rate: 18.5000 (from ECB)
  - Override Rate: [input field]
  - Reason: [text area]
  â†“
Step 5: User enters:
  - Override Rate: 19.0000
  - Reason: "Bank charged higher rate due to foreign transaction fee"
  â†“
Step 6: System validates:
  - Rate > 0? âœ…
  - Variance from ECB: (19.00 - 18.50) / 18.50 = 2.7%
  - Variance < 10%? âœ… (auto-allow)
  â†“
Step 7: System recalculates:
  - Old: $100 Ã— 18.5000 = $1,850 MXN
  - New: $100 Ã— 19.0000 = $1,900 MXN
  â†“
Step 8: System updates NormalizedAmount:
  - normalized_amount: 1900.00
  - exchange_rate: 19.0000
  - rate_source: "manual"
  - override_reason: "Bank charged..."
  â†“
Step 9: User sees updated display:
  - "$1,900.00 MXN ($100.00 USD @ 19.00*)"
  - "*" indicates manual override
  - ExchangeRateWidget shows override reason
  â†“
Step 10: Audit trail logs manual rate change
```

### Wireframe: Manual Override Dialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Override Exchange Rate                         Ã— â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Current Rate (ECB):                               â”‚
â”‚  1 USD = 18.5000 MXN                              â”‚
â”‚                                                    â”‚
â”‚  Override Rate:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 19.0000                                      â”‚ â”‚  â† User input
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  Variance: +2.7% from ECB rate                    â”‚  â† Auto-calculated
â”‚  âœ… Within acceptable range (<10%)                â”‚
â”‚                                                    â”‚
â”‚  Reason for Override:                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Bank charged higher rate due to foreign     â”‚ â”‚
â”‚  â”‚ transaction fee                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  Preview:                                          â”‚
â”‚  $100.00 USD â†’ $1,900.00 MXN                      â”‚
â”‚                                                    â”‚
â”‚                        [Cancel]  [Save Override]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Error Handling

**Error: Variance >10%**
- **Trigger:** User enters rate with >10% variance from ECB
- **Message:** "âš ï¸ Override rate is 15% higher than ECB. Are you sure?"
- **Recovery:** Require explicit confirmation checkbox

---

## Journey 5: Change Timezone

### User Goal
User moved to a different timezone and wants dates displayed in their new local time.

### Entry Point
- **Settings > Currency & Display**

### User Flow

```
Step 1: User opens Settings â†’ Currency & Display
  â†“
Step 2: User sees current timezone: "America/Mexico_City (GMT-6)"
  â†“
Step 3: User clicks [Change Timezone]
  â†“
Step 4: Timezone Selector Dialog appears:
  - Popular timezones first (America/New_York, Europe/London, Asia/Tokyo)
  - Search: "madrid"
  â†“
Step 5: User selects "Europe/Madrid (GMT+1)"
  â†“
Step 6: System confirms: "This will update all date/time displays. Continue?"
  â†“
Step 7: User clicks [Confirm]
  â†“
Step 8: System updates CurrencyConfig:
  - timezone: "Europe/Madrid"
  â†“
Step 9: System re-renders all dates:
  - Before: "Nov 1, 2024 10:00 AM" (Mexico City)
  - After: "Nov 1, 2024 5:00 PM" (Madrid)
  - UTC stored value unchanged: "2024-11-01T16:00:00Z"
  â†“
Step 10: User sees confirmation: "âœ… Timezone changed to Europe/Madrid"
```

### Wireframe: Timezone Selector

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Select Timezone                                Ã— â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  ðŸ” [Search timezones...                        ]  â”‚
â”‚                                                    â”‚
â”‚  âœ¨ Popular Timezones                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸŒŽ America/New_York (GMT-5)                 â”‚ â”‚
â”‚  â”‚    Currently: Nov 1, 2024 11:00 AM          â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚ ðŸŒ Europe/London (GMT+0)                    â”‚ â”‚
â”‚  â”‚    Currently: Nov 1, 2024 4:00 PM           â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚ ðŸŒ Asia/Tokyo (GMT+9)                       â”‚ â”‚
â”‚  â”‚    Currently: Nov 2, 2024 1:00 AM           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  All Timezones (A-Z) â–¼                             â”‚
â”‚                                                    â”‚
â”‚                        [Cancel]  [Select]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Journey 6: View Historical Exchange Rate

### User Goal
User wants to see what the exchange rate was 6 months ago to understand historical conversions.

### Entry Point
- **Settings > Exchange Rate History**

### User Flow

```
Step 1: User opens Settings â†’ Exchange Rate History
  â†“
Step 2: Historical Rate Query Form appears:
  - From Currency: [dropdown]
  - To Currency: [dropdown]
  - Date Range: [date pickers]
  â†“
Step 3: User selects:
  - From: USD
  - To: EUR
  - Date: May 1, 2024
  â†“
Step 4: User clicks [Get Rate]
  â†“
Step 5: ExchangeRateProvider.get_rate(USD, EUR, "2024-05-01") called:
  - Checks historical cache
  - Cache miss â†’ Fetch from ECB historical API
  - Returns: 0.9200
  â†“
Step 6: User sees result:
  - Rate: 0.9200
  - Date: May 1, 2024
  - Source: ECB Historical
  - Trend: "+2.1% vs today's rate (0.9400)"
  â†“
Step 7: User can optionally view chart (line graph of rate over time)
```

### Wireframe: Historical Rate Query

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Exchange Rate History                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  From Currency:                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ USD - US Dollar                        â–¼    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  To Currency:                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ EUR - Euro                             â–¼    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  Date:                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ May 1, 2024                            ðŸ“…   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚                                    [Get Rate]      â”‚
â”‚                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                    â”‚
â”‚  Result:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1 USD = 0.9200 EUR                          â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚ Date: May 1, 2024                           â”‚ â”‚
â”‚  â”‚ Source: ECB Historical                      â”‚ â”‚
â”‚  â”‚ Trend: +2.1% vs today (0.9400)             â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚ [View Chart]                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Multi-Domain Examples

### Healthcare: International Medical Claim

**Journey:** View claim in original + converted currency

```
Patient receives bill: â‚¬5,000.00 EUR (France)
US insurance reimburses in: $5,250.00 USD

Display:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Medical Claim #12345                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Reimbursement Amount:                      â”‚
â”‚ $5,250.00 USD                             â”‚
â”‚ (â‚¬5,000.00 EUR @ 1.0500)                  â”‚
â”‚                                            â”‚
â”‚ Claim Date: Nov 1, 2024                   â”‚
â”‚ Provider: HÃ´pital Paris                   â”‚
â”‚ Rate Source: ECB                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### E-commerce: Product Pricing

**Journey:** Display product price in customer's local currency

```
Product: Laptop ($999.99 USD base price)
Customer in Mexico sees:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MacBook Pro 14"                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Price: $18,499.81 MXN                     â”‚
â”‚ (US $999.99 @ 18.50)                      â”‚
â”‚                                            â”‚
â”‚ Rate updated: 2 hours ago                  â”‚
â”‚ [Add to Cart]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Travel: Expense Reporting

**Journey:** Submit expense with foreign currency conversion

```
Employee traveled to London, spent Â£200 GBP
Company reimburses in USD:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Travel Expense Report                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Hotel (London Hilton):                     â”‚
â”‚ $255.00 USD                               â”‚
â”‚ (Â£200.00 GBP @ 1.2750)                    â”‚
â”‚                                            â”‚
â”‚ Date: Oct 15, 2024                        â”‚
â”‚ Rate: Federal Reserve                      â”‚
â”‚ [Submit for Approval]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Accessibility Considerations

**Keyboard Navigation:**
- Tab through all interactive elements (currency selector, refresh button, etc.)
- Enter/Space to activate buttons
- Escape to close dialogs

**Screen Reader:**
- Announce currency amounts with both original and normalized values
- Announce staleness warnings ("Warning: Exchange rate is stale")
- Announce loading states ("Refreshing exchange rate")

**Visual:**
- High contrast for stale rate warnings (red background + icon)
- Color-blind safe: Use icons (âš ï¸) in addition to color
- Large text for amounts (minimum 16px)

**Localization:**
- Format amounts according to user's locale
- Display currency symbols correctly ($ vs â‚¬ vs Â£)
- Support RTL languages (Arabic, Hebrew)

---

## Performance Considerations

**Cache Hit Rate:** >90% (most conversions use cached rates)
**Refresh Latency:** <500ms p95 (ECB API call)
**Batch Conversion:** 1000 transactions/sec (single rate fetch)
**UI Responsiveness:** <100ms (no janky scrolling)

---

## Analytics & Metrics

**Track:**
- % users who set base currency during onboarding
- % transactions with stale rates
- % manual overrides (target: <5%)
- Avg time to refresh rate (target: <2 seconds)
- % users who change timezone after setup

**Success Metrics:**
- User completes onboarding (base currency set)
- User understands dual currency display (clicks tooltip)
- User refreshes stale rate successfully
- User creates manual override with reason

---

**Total Lines:** ~1,240
