# UX Flow: Normalization Experience (Vertical 1.3)

**Version**: 1.0
**Status**: Formalized
**Last Updated**: 2025-10-23
**Related Vertical**: 1.3 (Normalization)

---

## Overview

**What users see during and after normalization:**

While **normalization is automated (no user interaction during processing)**, users need visibility into:
1. **Progress:** "Normalizing transactions..." (status indicator)
2. **Results:** "95/100 transactions normalized" (success summary)
3. **Errors:** "5 transactions failed validation" (with details)
4. **Warnings:** "8 possible duplicates detected" (flags for review)
5. **Actions:** Review failed transactions, confirm/dismiss duplicates, manually categorize

**Key principle:** Normalization happens in background, but user has full observability and control over results.

---

## User Journeys

### Journey 1: Happy Path (All Transactions Normalized)

**Context:** User uploaded bank statement, extraction succeeded, now normalizing.

**Steps:**

1. **Upload complete, parsing complete:**
   - UI shows: "Parsing complete: 42 transactions extracted"
   - Status: "Normalizing..." (spinner icon)

2. **Normalization in progress:**
   - Status updates: "Normalizing transactions..." (progress bar or spinner)
   - Time estimate: "Usually takes a few seconds"
   - (No user action required)

3. **Normalization complete (all succeed):**
   - UI updates: "✅ 42 transactions ready to review"
   - Status: "Normalized" (green checkmark)
   - Summary: "All transactions validated and categorized"

4. **User reviews transactions:**
   - Transactions list shows: Date, Merchant, Amount, Category
   - Categories: Auto-inferred (e.g., "Starbucks" → "Food & Drink")
   - User can: Edit categories, add notes, confirm transactions

5. **User confirms and proceeds:**
   - Click "Looks good" → proceed to dashboard/analytics
   - All 42 transactions now part of canonical dataset

---

### Journey 2: Partial Success (Some Transactions Fail Validation)

**Context:** User uploaded statement with some invalid data (e.g., corrupted rows).

**Steps:**

1. **Normalization completes with failures:**
   - UI shows: "⚠️ 95/100 transactions normalized"
   - Status: "Normalized (with errors)" (yellow warning icon)
   - Summary: "5 transactions failed validation"

2. **User clicks "View errors":**
   - Drawer opens showing failed transactions
   - For each failure:
     - Row number: "Row 42"
     - Raw data: `date="invalid_date", amount="-5.75", description="STARBUCKS"`
     - Error: "Unparseable date format"
     - Action: [Edit manually] [Skip]

3. **User chooses action:**
   - **Option A: Edit manually**
     - Modal opens with form: Date (datepicker), Amount (input), Description (input)
     - User corrects date: "2025-01-15"
     - Click "Save" → transaction re-normalized → added to canonicals
   - **Option B: Skip**
     - Transaction remains in failed state
     - Can revisit later in "Failed transactions" tab

4. **User proceeds with 95 valid transactions:**
   - Click "Continue with 95 transactions" → dashboard/analytics
   - Failed transactions logged for later review

---

### Journey 3: Duplicate Detection (Flags for Review)

**Context:** User uploads multiple statements with overlapping dates → duplicates detected.

**Steps:**

1. **Normalization completes with warnings:**
   - UI shows: "✅ 100 transactions normalized"
   - Status: "Normalized (8 duplicates detected)" (blue info icon)
   - Summary: "8 possible duplicates flagged for review"

2. **User clicks "Review duplicates":**
   - Drawer opens showing flagged transactions
   - For each duplicate:
     - Transaction A: "01/15/2025 | Starbucks | -$5.75 | Debit Card"
     - Transaction B: "01/15/2025 | Starbucks | -$5.75 | Credit Card"
     - Similarity: "Same date, amount, merchant (±1 day)"
     - Action: [Keep both] [Keep A, delete B] [Keep B, delete A]

3. **User resolves duplicates:**
   - **Option A: Keep both** (they're actually different transactions)
     - Click "Keep both" → both marked as unique → no longer flagged
   - **Option B: Delete duplicate**
     - Click "Keep A, delete B" → Transaction B deleted → only A remains

4. **User confirms and proceeds:**
   - All duplicates resolved
   - UI shows: "100 unique transactions" → dashboard/analytics

---

### Journey 4: Uncategorized Transactions (Manual Review)

**Context:** Normalization succeeds but many transactions uncategorized (unknown merchants).

**Steps:**

1. **Normalization completes with low category coverage:**
   - UI shows: "✅ 100 transactions normalized"
   - Status: "Normalized (25 uncategorized)" (yellow warning icon)
   - Summary: "25 transactions need manual categorization"

2. **User clicks "Categorize transactions":**
   - Drawer opens showing uncategorized transactions
   - For each transaction:
     - Transaction: "01/15/2025 | XYZ CORP 123456 | -$127.50"
     - Category: "Uncategorized" (dropdown)
     - Action: [Select category]

3. **User categorizes transactions:**
   - Click dropdown → select "Business Expenses"
   - System learns: "XYZ CORP 123456" → "Business Expenses" (future transactions auto-categorized)
   - Repeat for all 25 transactions (or bulk select)

4. **User confirms and proceeds:**
   - All transactions categorized → dashboard shows breakdown by category

---

### Journey 5: Large Amount Warnings (Fraud Prevention)

**Context:** Normalization detects unusually large transaction (>$10k threshold).

**Steps:**

1. **Normalization completes with warnings:**
   - UI shows: "✅ 100 transactions normalized"
   - Status: "Normalized (1 large amount detected)" (blue info icon)
   - Alert: "⚠️ Large transaction detected: $15,750.00 on 01/20/2025"

2. **User clicks "Review large transaction":**
   - Modal opens showing transaction details:
     - Date: "01/20/2025"
     - Merchant: "ABC Real Estate"
     - Amount: "$15,750.00"
     - Category: "Housing"
     - Warning: "Amount exceeds $10,000 threshold"
     - Question: "Is this transaction correct?"

3. **User verifies transaction:**
   - **Option A: Confirm** (it's correct)
     - Click "Yes, this is correct" → warning dismissed
   - **Option B: Report error** (it's wrong)
     - Click "No, report error" → transaction flagged for manual review
     - Support team investigates (possible parser error)

4. **User proceeds:**
   - Warning resolved → dashboard/analytics

---

## UI States

### State 1: Normalizing (In Progress)

**Status badge:**
```
┌────────────────────────────────┐
│ Status: Normalizing...         │
│ ⏳ Processing 100 transactions │
└────────────────────────────────┘
```

**Upload card:**
```
┌─────────────────────────────────────────────┐
│ 📄 Upload: statement_jan.pdf                │
│                                             │
│ Status: Normalizing ⏳                      │
│ Progress: [████████░░] 80%                  │
│                                             │
│ [View raw data]                             │
└─────────────────────────────────────────────┘
```

**User actions:** None (wait for completion)

---

### State 2: Normalized (All Success)

**Status badge:**
```
┌────────────────────────────────┐
│ Status: Normalized ✅          │
│ 42 transactions ready          │
└────────────────────────────────┘
```

**Upload card:**
```
┌─────────────────────────────────────────────┐
│ ✅ Upload: statement_jan.pdf                 │
│                                             │
│ Status: Normalized                          │
│ Transactions: 42/42 validated               │
│                                             │
│ [View transactions] [Download]              │
└─────────────────────────────────────────────┘
```

**User actions:** View transactions, proceed to dashboard

---

### State 3: Normalized (With Errors)

**Status badge:**
```
┌────────────────────────────────┐
│ Status: Normalized ⚠️          │
│ 95/100 transactions validated  │
│ 5 failed validation            │
└────────────────────────────────┘
```

**Upload card:**
```
┌─────────────────────────────────────────────┐
│ ⚠️ Upload: statement_jan.pdf                 │
│                                             │
│ Status: Normalized (with errors)            │
│ Transactions: 95/100 validated              │
│ Errors: 5 transactions failed               │
│                                             │
│ [View errors] [View valid transactions]     │
└─────────────────────────────────────────────┘
```

**User actions:** View errors, edit manually or skip

---

### State 4: Normalized (With Warnings)

**Status badge:**
```
┌────────────────────────────────┐
│ Status: Normalized ℹ️          │
│ 100 transactions validated     │
│ 8 duplicates detected          │
└────────────────────────────────┘
```

**Upload card:**
```
┌─────────────────────────────────────────────┐
│ ℹ️ Upload: statement_jan.pdf                 │
│                                             │
│ Status: Normalized (review needed)          │
│ Transactions: 100/100 validated             │
│ Duplicates: 8 possible duplicates           │
│ Uncategorized: 15 transactions              │
│                                             │
│ [Review duplicates] [Categorize] [Continue] │
└─────────────────────────────────────────────┘
```

**User actions:** Review duplicates, categorize, or proceed

---

## Wireframes

### Desktop: Normalized Transactions List

```
┌──────────────────────────────────────────────────────────────────┐
│ Finance App                            [Profile] [Settings] [?]   │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  📊 Transactions (January 2025)                  [Export] [+]    │
│                                                                  │
│  Filters: [All Categories ▼] [All Accounts ▼] [Date Range ▼]    │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ Date       Merchant        Amount    Category     Account   │  │
│  ├────────────────────────────────────────────────────────────┤  │
│  │ 01/15/2025 Starbucks       -$5.75   Food & Drink  Debit    │  │
│  │ 01/15/2025 Shell Gas       -$45.00  Transport     Debit    │  │
│  │ 01/16/2025 Amazon          -$127.49 Shopping      Credit   │  │
│  │ 01/17/2025 Salary          +$2500   Income        Checking │  │
│  │ 01/18/2025 Rent Payment    -$1500   Housing       Checking │  │
│  │ 01/20/2025 ⚠️ XYZ CORP      -$127.50 Uncategorized Debit    │  │
│  │            [Categorize]                                     │  │
│  │ 01/22/2025 ℹ️ Starbucks     -$5.75   Food & Drink  Credit   │  │
│  │            Possible duplicate of 01/15/2025                 │  │
│  │            [Keep both] [Delete this]                        │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  Showing 42 transactions | Total spent: -$3,127.49              │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

---

### Desktop: Error Details Drawer

```
┌──────────────────────────────────────────────────────────────────┐
│ Finance App                                   [×] Close           │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ❌ Validation Errors (5 transactions)                           │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ Row 42                                                      │  │
│  │ ────────────────────────────────────────────────────────── │  │
│  │ Raw Data:                                                   │  │
│  │   Date: "invalid_date"                                      │  │
│  │   Amount: "-5.75"                                           │  │
│  │   Description: "STARBUCKS #1234"                            │  │
│  │                                                             │  │
│  │ Error: Unparseable date format                              │  │
│  │                                                             │  │
│  │ [Edit manually] [Skip]                                      │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐  │
│  │ Row 78                                                      │  │
│  │ ────────────────────────────────────────────────────────── │  │
│  │ Raw Data:                                                   │  │
│  │   Date: "01/15/2025"                                        │  │
│  │   Amount: "N/A"                                             │  │
│  │   Description: "REFUND"                                     │  │
│  │                                                             │  │
│  │ Error: Amount parse error (non-numeric value)               │  │
│  │                                                             │  │
│  │ [Edit manually] [Skip]                                      │  │
│  └────────────────────────────────────────────────────────────┘  │
│                                                                  │
│  [Continue with valid transactions (95)]                        │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

---

### Mobile: Normalized Transaction Card (Warning)

```
┌─────────────────────────────────┐
│ ℹ️ Possible Duplicate             │
├─────────────────────────────────┤
│                                 │
│ 📅 01/15/2025                    │
│ 🏪 Starbucks                     │
│ 💵 -$5.75                        │
│ 📁 Food & Drink                  │
│ 💳 Credit Card                   │
│                                 │
│ ⚠️ Similar transaction found:    │
│   01/15/2025 | Starbucks        │
│   -$5.75 | Debit Card           │
│                                 │
│ [Keep both]  [Delete this]      │
│                                 │
└─────────────────────────────────┘
```

---

## Notifications

### Push Notification: Normalization Complete

**Trigger:** Normalization finishes while user is away from app.

```
┌─────────────────────────────────┐
│ Finance App                     │
│                                 │
│ ✅ 42 transactions ready         │
│ Your January statement has been │
│ processed and is ready to       │
│ review.                         │
│                                 │
│ [View now]  [Dismiss]           │
└─────────────────────────────────┘
```

---

### Push Notification: Normalization Errors

**Trigger:** Normalization completes with failures.

```
┌─────────────────────────────────┐
│ Finance App                     │
│                                 │
│ ⚠️ Action needed                 │
│ 5 transactions failed           │
│ validation. Review and fix.     │
│                                 │
│ [Review errors]  [Dismiss]      │
└─────────────────────────────────┘
```

---

### Push Notification: Duplicates Detected

**Trigger:** Normalization detects possible duplicates.

```
┌─────────────────────────────────┐
│ Finance App                     │
│                                 │
│ ℹ️ Duplicates detected           │
│ 8 possible duplicate            │
│ transactions found. Review to   │
│ avoid double-counting.          │
│                                 │
│ [Review]  [Dismiss]             │
└─────────────────────────────────┘
```

---

## Accessibility

### Screen Reader Announcements

**Normalization in progress:**
- "Normalizing transactions. Please wait."
- ARIA live region updates: "80% complete"

**Normalization complete (success):**
- "Normalization complete. 42 transactions validated and ready to review."

**Normalization complete (with errors):**
- "Normalization complete with errors. 95 out of 100 transactions validated. 5 transactions failed. Click 'View errors' for details."

**Normalization complete (with warnings):**
- "Normalization complete. 100 transactions validated. 8 possible duplicates detected. Click 'Review duplicates' to resolve."

---

### Keyboard Navigation

**Upload card (normalized with errors):**
1. `Tab` → Focus on "View errors" button
2. `Enter` → Open error details drawer
3. `Tab` → Focus on first error's "Edit manually" button
4. `Enter` → Open edit modal
5. `Esc` → Close modal, return to drawer
6. `Esc` → Close drawer, return to upload card

**Duplicate resolution:**
1. `Tab` → Focus on "Keep both" button
2. `Arrow Right` → Focus on "Keep A, delete B" button
3. `Arrow Right` → Focus on "Keep B, delete A" button
4. `Enter` → Execute selected action

---

## Performance

### Perceived Performance

**Instant feedback:**
- Status updates: <100ms after backend state change
- Progress bar: Smooth animation (no jank)
- Drawer open/close: <200ms transition

**Optimistic UI:**
- User action (e.g., "Keep both duplicates") → immediate UI update
- Backend confirmation happens async
- If fails, revert UI and show error

**Batch updates:**
- If resolving 8 duplicates → don't refresh UI 8 times
- Single refresh after all actions processed

---

### Loading States

**Normalization in progress:**
- Show spinner or progress bar (if backend provides progress)
- Disable actions ("View transactions" button grayed out)

**Error drawer loading:**
- Skeleton UI while fetching error details from NormalizationLog
- Fade in content when loaded

---

## Decision Points

### 1. Real-Time Progress vs. Final Result Only?

**Option A: Real-time progress bar**
- Show: "Normalizing 45/100 transactions..."
- Requires: Backend WebSocket or polling

**Option B: Spinner until complete**
- Show: "Normalizing..." (no percentage)
- Simpler: Just poll status (parsed → normalizing → normalized)

**Decision:** Start with Option B (simpler), upgrade to A if users complain.

---

### 2. Auto-Resolve Duplicates vs. Always Ask User?

**Option A: Auto-resolve high-confidence duplicates**
- If similarity >95% → auto-delete duplicate
- Only show low-confidence (<95%) to user

**Option B: Always ask user**
- Show all duplicates, let user decide

**Decision:** Start with Option B (user control), add A as "Auto-resolve duplicates" setting.

---

### 3. Inline Editing vs. Modal?

**Option A: Inline editing** (edit failed transaction directly in list)
- Faster, fewer clicks
- Harder on mobile (small inputs)

**Option B: Modal** (click "Edit manually" → form opens)
- More space, clearer UI
- Extra click

**Decision:** Use Option B (modal) for clarity, especially on mobile.

---

## Edge Cases

**1. All transactions fail normalization:**
- Show: "❌ All transactions failed validation"
- Action: "View errors and fix manually" (required before proceeding)

**2. Zero warnings (perfect normalization):**
- Show: "✅ All transactions validated with no issues"
- Action: "View transactions" → proceed

**3. User ignores errors and proceeds:**
- Warning modal: "5 transactions will be excluded. Continue?"
- Confirm → proceed with valid transactions only

**4. User dismisses duplicate warning:**
- Duplicates remain in dataset (both counted)
- Can revisit later in "Flagged transactions" tab

**5. Normalization fails (backend error):**
- Show: "❌ Normalization failed. Please try again."
- Action: [Retry] (re-run normalizer on same observations)

---

## Summary

**Key UX principles for normalization:**

1. **Visibility:** User always knows what's happening (status updates)
2. **Control:** User can review errors, resolve duplicates, categorize
3. **Flexibility:** Partial success allowed (don't block for bad rows)
4. **Feedback:** Clear error messages, actionable warnings
5. **Accessibility:** Screen reader support, keyboard navigation
6. **Performance:** Instant UI updates, optimistic actions

**Next vertical:** 2.1 (Transaction List View) — View, filter, and explore canonical transactions with pagination.
