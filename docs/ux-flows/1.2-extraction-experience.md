# UX Flow 1.2: Extraction Experience

**Version**: 1.0
**Last Updated**: 2025-10-23
**Related Vertical**: [1.2 Extraction](../verticals/1.2-extraction.md)

---

## Overview

Although parsing is an **automated backend process**, users still experience it through:
- Status updates (parsing → parsed)
- Error messages (if parsing fails)
- Observation counts (how many transactions extracted)
- Logs (debugging, transparency)
- Manual retry (after errors)

This document specifies the user-facing experience of the extraction stage.

---

## User Journeys

### Journey 1: Happy Path (Successful Parse)

**Scenario:** User uploads valid bank statement, parser extracts 42 transactions

**Steps:**

1. **Upload completes** (from vertical 1.1)
   ```
   User sees: "Upload successful! Processing..."
   Status: queued_for_parse
   ```

2. **Parsing starts** (automatic, ~2-5 seconds later)
   ```
   User sees: Status changes to "Parsing..."
   UI shows: Spinner animation
   Status: parsing
   ```

3. **Parsing completes** (automatic, ~3-30 seconds later)
   ```
   User sees: "✓ Parsed: 42 transactions extracted"
   Status: parsed
   Next action: "View Transactions" button enabled
   ```

4. **User drills down** (optional)
   ```
   Click "View Details" → Shows:
   - Parser used: bofa_pdf_parser v1.2.0
   - Duration: 3.4s
   - Rows extracted: 42
   - Warnings: None
   - Link to ParseLog
   ```

**Timeline:**
```
Upload → [2s wait] → Parsing starts → [3s parsing] → Parsed
   ↓                       ↓                            ↓
  UI: "Processing..."    "Parsing..."          "✓ 42 transactions"
```

---

### Journey 2: Error - Corrupted PDF

**Scenario:** User uploads corrupted/unreadable PDF

**Steps:**

1. **Upload completes** (file accepted)
   ```
   User sees: "Upload successful! Processing..."
   Status: queued_for_parse
   ```

2. **Parsing starts**
   ```
   User sees: "Parsing..."
   Status: parsing
   ```

3. **Parsing fails** (automatic)
   ```
   User sees:
   ✗ Parsing failed: PDF file is corrupted or unreadable

   Status: error
   Error code: PDF_CORRUPT

   Actions available:
   [View Error Details] [Retry] [Upload Different File]
   ```

4. **User views error details** (optional)
   ```
   Modal shows:
   - Error: PDF_CORRUPT
   - Message: "Failed to open PDF: Invalid header at byte 0"
   - ParseLog: /logs/parse/UL_def456.log.json
   - Suggestion: "Try re-downloading the statement from your bank"
   ```

5. **User retries** (manual trigger)
   ```
   Click [Retry] → Status returns to queued_for_parse
   Parser re-runs (full flow repeats)
   ```

**Error UI:**
```
┌─────────────────────────────────────────────┐
│ ✗ Upload: statement_jan.pdf                 │
│                                             │
│ Status: Parsing failed                      │
│ Error: PDF file is corrupted or unreadable  │
│                                             │
│ [View Error Details] [Retry] [Delete]      │
└─────────────────────────────────────────────┘
```

---

### Journey 3: Empty Statement (0 Transactions)

**Scenario:** User uploads valid PDF but statement has no transactions (new account, zero activity)

**Steps:**

1. **Upload completes**
   ```
   Status: queued_for_parse
   ```

2. **Parsing completes successfully**
   ```
   User sees:
   ⚠ Parsed: 0 transactions found

   Status: parsed
   Warning: "No transactions found in this statement (empty account)"

   Actions: [View Details] [Upload Another]
   ```

3. **User views details** (optional)
   ```
   Shows:
   - Parser: bofa_pdf_parser v1.2.0
   - Rows extracted: 0
   - Warning: "No transactions found in statement (empty account)"
   - Severity: Medium
   - Note: "This is not an error - the statement may be from a new or inactive account"
   ```

**Important:** 0 transactions = **success, not error**

**UI Treatment:**
```
┌─────────────────────────────────────────────┐
│ ⚠ Upload: new_account.pdf                   │
│                                             │
│ Status: Parsed successfully                 │
│ Transactions: 0 (empty statement)           │
│                                             │
│ This is normal for new/inactive accounts.   │
│                                             │
│ [View Details] [Upload Another]            │
└─────────────────────────────────────────────┘
```

---

### Journey 4: Layout Mismatch (Bank Changed Format)

**Scenario:** Bank updated statement format, parser can't extract

**Steps:**

1. **Parsing fails**
   ```
   User sees:
   ✗ Parsing failed: Statement format not recognized

   Error code: LAYOUT_MISMATCH
   Message: "This statement format is different from expected.
            The bank may have updated their PDF layout."

   Actions: [Report Issue] [Upload Different File]
   ```

2. **User reports issue** (optional)
   ```
   Click [Report Issue] → Pre-filled form:
   - Upload ID: UL_xyz789
   - Parser: bofa_pdf_parser v1.2.0
   - Error: LAYOUT_MISMATCH
   - Statement date: [user enters]
   - Comments: [user explains]

   Sends alert to admin: "Parser needs update"
   ```

**System response (behind scenes):**
- Alert sent to admin
- Issue tracked for parser update
- User notified when parser upgraded

---

## UI States & Components

### Status Badge Component

**States:**

```
┌─────────────────┐
│ ⏳ Processing   │  ← queued_for_parse (gray)
└─────────────────┘

┌─────────────────┐
│ 🔄 Parsing...   │  ← parsing (blue, animated)
└─────────────────┘

┌─────────────────┐
│ ✓ Parsed        │  ← parsed (green)
└─────────────────┘

┌─────────────────┐
│ ✗ Failed        │  ← error (red)
└─────────────────┘
```

**Implementation:**
```typescript
<StatusBadge status={upload.status} />

// Renders:
// - Icon (⏳, 🔄, ✓, ✗)
// - Label ("Processing", "Parsing...", "Parsed", "Failed")
// - Color (gray, blue, green, red)
// - Animation (spinner for parsing)
```

---

### Upload List View

**Desktop wireframe:**
```
┌─────────────────────────────────────────────────────────────────────┐
│ Your Uploads                                          [Upload New +] │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│ ┌─────────────────────────────────────────────────────────────────┐ │
│ │ 📄 statement_jan.pdf                         ✓ Parsed            │ │
│ │ Uploaded: 2 minutes ago                      42 transactions     │ │
│ │ Parser: BofA PDF v1.2.0                      Duration: 3.4s      │ │
│ │                                                                   │ │
│ │ [View Transactions] [View Details] [Delete]                      │ │
│ └─────────────────────────────────────────────────────────────────┘ │
│                                                                       │
│ ┌─────────────────────────────────────────────────────────────────┐ │
│ │ 📄 statement_feb.pdf                         🔄 Parsing...       │ │
│ │ Uploaded: 10 seconds ago                     Extracting data...  │ │
│ │ Parser: BofA PDF v1.2.0                                          │ │
│ │                                                                   │ │
│ │ [Cancel]                                                          │ │
│ └─────────────────────────────────────────────────────────────────┘ │
│                                                                       │
│ ┌─────────────────────────────────────────────────────────────────┐ │
│ │ 📄 corrupted.pdf                             ✗ Failed            │ │
│ │ Uploaded: 5 minutes ago                      PDF_CORRUPT         │ │
│ │ Error: PDF file is corrupted or unreadable                       │ │
│ │                                                                   │ │
│ │ [View Error Details] [Retry] [Delete]                            │ │
│ └─────────────────────────────────────────────────────────────────┘ │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘
```

**Mobile wireframe:**
```
┌───────────────────────────┐
│ Your Uploads              │
│                 [+ New]   │
├───────────────────────────┤
│                           │
│ ┌───────────────────────┐ │
│ │ 📄 statement_jan.pdf  │ │
│ │                       │ │
│ │ ✓ Parsed              │ │
│ │ 42 transactions       │ │
│ │ 2 min ago            │ │
│ │                       │ │
│ │ [View] [Details]      │ │
│ └───────────────────────┘ │
│                           │
│ ┌───────────────────────┐ │
│ │ 📄 statement_feb.pdf  │ │
│ │                       │ │
│ │ 🔄 Parsing...         │ │
│ │ Extracting...         │ │
│ │ 10s ago              │ │
│ └───────────────────────┘ │
│                           │
│ ┌───────────────────────┐ │
│ │ 📄 corrupted.pdf      │ │
│ │                       │ │
│ │ ✗ Failed              │ │
│ │ PDF_CORRUPT           │ │
│ │ 5 min ago            │ │
│ │                       │ │
│ │ [Retry] [Details]     │ │
│ └───────────────────────┘ │
│                           │
└───────────────────────────┘
```

---

### Parse Details Modal

**Triggered by:** Click "View Details" on any upload

**Content (success case):**
```
┌─────────────────────────────────────────────────────┐
│ Parse Details: statement_jan.pdf               [×]  │
├─────────────────────────────────────────────────────┤
│                                                     │
│ Status: ✓ Parsed successfully                      │
│                                                     │
│ Parser Information:                                 │
│   • Parser ID: bofa_pdf_parser                     │
│   • Version: 1.2.0                                 │
│   • Started: 2025-10-23 14:30:00 UTC              │
│   • Completed: 2025-10-23 14:30:03 UTC            │
│   • Duration: 3.4 seconds                          │
│                                                     │
│ Results:                                            │
│   • Transactions extracted: 42                     │
│   • Rows skipped: 1 (header row)                  │
│   • Warnings: 1                                    │
│   • Errors: 0                                      │
│                                                     │
│ Warnings:                                           │
│   ⚠ Row 15: Date format ambiguous (01/02/2024)    │
│      Assumed MM/DD/YYYY format                     │
│      Severity: Low                                 │
│                                                     │
│ File Information:                                   │
│   • Size: 2.4 MB                                   │
│   • Hash: sha256:abc123...                         │
│   • MIME type: application/pdf                     │
│                                                     │
│ Logs:                                               │
│   [View Full ParseLog] (opens /logs/parse/...)     │
│                                                     │
│ Actions:                                            │
│   [View Transactions] [Close]                      │
│                                                     │
└─────────────────────────────────────────────────────┘
```

**Content (error case):**
```
┌─────────────────────────────────────────────────────┐
│ Parse Details: corrupted.pdf                   [×]  │
├─────────────────────────────────────────────────────┤
│                                                     │
│ Status: ✗ Parsing failed                           │
│                                                     │
│ Error Information:                                  │
│   • Error Code: PDF_CORRUPT                        │
│   • Message: Failed to open PDF - Invalid header   │
│   • Occurred at: 2025-10-23 15:00:01 UTC          │
│                                                     │
│ Parser Information:                                 │
│   • Parser ID: bofa_pdf_parser                     │
│   • Version: 1.2.0                                 │
│   • Duration: 1.2 seconds (failed early)           │
│                                                     │
│ File Information:                                   │
│   • Size: 1 KB (suspiciously small)                │
│   • Hash: sha256:def456...                         │
│   • MIME type: application/pdf                     │
│                                                     │
│ What this means:                                    │
│   The PDF file appears to be corrupted or           │
│   incomplete. This can happen if:                   │
│   • Download was interrupted                        │
│   • File was damaged                                │
│   • Bank's website had an issue                     │
│                                                     │
│ Suggested Actions:                                  │
│   1. Re-download the statement from your bank       │
│   2. Try opening the PDF on your computer          │
│   3. If it opens, the issue may be temporary       │
│                                                     │
│ Technical Details:                                  │
│   [View Full ParseLog] [View Stack Trace]          │
│                                                     │
│ Actions:                                            │
│   [Retry Parsing] [Upload New File] [Close]        │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## Notifications

### Push/Email Notifications (Optional, v2)

**Parse completed:**
```
Subject: Statement parsed successfully
Body:
Your statement "statement_jan.pdf" has been processed.
✓ 42 transactions extracted
[View Transactions →]
```

**Parse failed:**
```
Subject: Statement parsing failed
Body:
Your statement "corrupted.pdf" could not be processed.
Error: PDF file is corrupted or unreadable
[View Details →] [Upload New File →]
```

---

## Loading States

### Inline Status (within upload card)

**queued_for_parse:**
```
Status: ⏳ Processing
Subtext: Waiting for parser...
```

**parsing:**
```
Status: 🔄 Parsing... (animated spinner)
Subtext: Extracting transactions... (updates every 5s)
Progress bar: Indeterminate (pulsing)
```

**parsed:**
```
Status: ✓ Parsed
Subtext: 42 transactions extracted
```

**error:**
```
Status: ✗ Failed
Subtext: PDF_CORRUPT
Link: View details →
```

---

## Empty States

### No Uploads Yet

```
┌─────────────────────────────────────────────┐
│                                             │
│              📄                             │
│                                             │
│      No uploads yet                         │
│                                             │
│  Upload a bank statement to get started     │
│                                             │
│         [Upload Statement]                  │
│                                             │
└─────────────────────────────────────────────┘
```

### All Uploads Parsed

```
┌─────────────────────────────────────────────┐
│ Your Uploads                   [Upload New +]│
├─────────────────────────────────────────────┤
│                                             │
│  ✓ All uploads processed successfully       │
│                                             │
│  3 statements parsed                        │
│  127 total transactions                     │
│                                             │
│  [View All Transactions]                    │
│                                             │
└─────────────────────────────────────────────┘
```

---

## Error States

### Parser Timeout (rare)

```
┌─────────────────────────────────────────────┐
│ ✗ Upload: large_statement.pdf               │
│                                             │
│ Status: Parsing timed out                   │
│ Error: Parser exceeded 30 second limit      │
│                                             │
│ This can happen with very large files.      │
│                                             │
│ [Retry] [Contact Support]                   │
└─────────────────────────────────────────────┘
```

### Parser Version Mismatch

```
┌─────────────────────────────────────────────┐
│ ✗ Upload: statement_2024.pdf                │
│                                             │
│ Status: Format not recognized               │
│ Error: LAYOUT_MISMATCH                      │
│                                             │
│ The statement format has changed.           │
│ We've been notified and will update the     │
│ parser soon.                                │
│                                             │
│ [Report Issue] [Try Different File]         │
└─────────────────────────────────────────────┘
```

---

## Accessibility

### Screen Reader Announcements

**When parsing starts:**
```
"Parsing statement_jan.pdf. Please wait."
```

**When parsing completes:**
```
"Parsing complete. 42 transactions extracted from statement_jan.pdf."
```

**When parsing fails:**
```
"Parsing failed. Error: PDF file is corrupted. View details for more information."
```

### Keyboard Navigation

- **Tab order:** Status → Actions (View/Retry/Delete) → Next upload
- **Enter on upload card:** Opens details modal
- **Escape in modal:** Closes modal
- **Space on [Retry]:** Triggers retry

---

## Performance Considerations

### Polling vs WebSocket

**Decision:** Use **polling** for v1 (simpler)

**Implementation:**
```typescript
// Poll every 2 seconds while status = "parsing"
useEffect(() => {
  if (upload.status === 'parsing') {
    const interval = setInterval(() => {
      fetchUploadStatus(upload.upload_id)
    }, 2000)

    return () => clearInterval(interval)
  }
}, [upload.status])
```

**Future (v2):** WebSocket for real-time updates

---

## Decision Points

### When to Show Progress Bar?

**Decision:** Show indeterminate progress bar (pulsing) during parsing

**Rationale:**
- Don't know exactly how long parsing will take
- Indeterminate conveys "working, please wait"
- Determinate would require parser progress events (v2 feature)

---

### How Long to Keep Failed Uploads?

**Decision:** Keep forever (until user deletes)

**Rationale:**
- User may want to retry later
- Error details useful for debugging
- ParseLog remains accessible

---

### Show Parse Duration to User?

**Decision:** Yes, in details modal only

**Rationale:**
- Advanced users appreciate transparency
- Helps identify slow parsers
- Not cluttering main UI

---

## Related Components (IL)

New components identified:

- `<UploadStatusBadge>` - Status indicator with icon/color
- `<ParseDetailsModal>` - Detailed parse information
- `<ParseErrorCard>` - Error display with suggestions
- `<ParseProgressIndicator>` - Spinner/progress during parsing
- `<RetryButton>` - Manual retry trigger

---

**Last Updated**: 2025-10-23
**Status**: Complete
**Related**: Vertical 1.2 (Extraction)
