# UX Flow 3.4: Tax Categorization Experience

> **Vertical:** 3.4 Tax Categorization (Regulatory Classification System)
> **Dependencies:** 1.3 Normalization (transactions must be normalized first), 3.2 Counterparty Registry (merchant patterns for auto-classification), 2.1 Transaction List (classification UI embedded)
> **User Story:** As a user, I want to categorize transactions according to tax regulations (USA Schedule C, Mexico SAT) so I can track deductible expenses, maintain compliance, and link supporting documentation (Facturas).

---

## User Journeys

### Journey 1: Classify Transaction with USA Schedule C Category (Manual)

**Context:** User has a normalized transaction for an Uber ride ($42.50) and wants to classify it as a business travel expense for tax deduction purposes.

**Steps:**

1. **Entry point:** User viewing Transaction List
   - URL: `/transactions`
   - User sees transaction: "Uber โข -$42.50 โข Oct 15, 2024"
   - Badge shows: "โช Not categorized"
   - User clicks transaction row to open detail drawer

2. **Transaction detail drawer opens:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Transaction Details                            [ร] โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ Uber                                               โ
   โ Oct 15, 2024                                       โ
   โ                                                    โ
   โ Amount: -$42.50                                    โ
   โ Account: Chase Business Credit                     โ
   โ Counterparty: Uber                                 โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
   โ                                                    โ
   โ Tax Classification                                 โ
   โ โช Not categorized yet                             โ
   โ                                                    โ
   โ Jurisdiction: USA Federal (auto-detected)          โ
   โ [Change Jurisdiction โผ]                            โ
   โ                                                    โ
   โ [Categorize for Tax Deduction]                     โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
   โ                                                    โ
   โ Notes:                                             โ
   โ [Add notes about this transaction...________]      โ
   โ                                                    โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

3. **User clicks "Categorize for Tax Deduction":**
   - TaxCategorySelector dropdown expands inline
   - Focus automatically on search field
   - System loads USA Schedule C categories

4. **Category selector appears (hierarchical display):**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Tax Category                                       โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ Search categories... [____________] ๐             โ
   โ                                                    โ
   โ USA FEDERAL - SCHEDULE C                           โ
   โ                                                    โ
   โ โธ Advertising (Line 8)                  100%       โ
   โ โธ Car and Truck Expenses (Line 9)      100%       โ
   โ โธ Legal and Professional (Line 17)     100%       โ
   โ โธ Meals (Business) (Line 24b)           50%       โ
   โ โธ Office Expenses (Line 18)            100%       โ
   โ โธ Travel (Line 24a)                    100%       โ
   โ   โโ Air Travel                        100%       โ
   โ   โโ Ground Transportation             100%       โ
   โ   โโ Lodging                           100%       โ
   โ   โโ Other Travel Expenses             100%       โ
   โ โธ Utilities (Line 25)                  100%       โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ      โ
   โ CUSTOM CATEGORIES (2)                              โ
   โ โธ Software Subscriptions               100%       โ
   โ โธ Client Gifts                           0%       โ
   โ                                                    โ
   โ [+ Create Custom Category]                         โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

5. **User searches for "travel":**
   - Types: "travel" in search field
   - Results filter in real-time:
     ```
     Search results for "travel": (4 matches)

     โธ Travel (Line 24a)                    100% โ
       โโ Air Travel                        100%
       โโ Ground Transportation             100%
       โโ Lodging                           100%
       โโ Other Travel Expenses             100%
     ```

6. **User selects "Travel > Ground Transportation":**
   - Hovers over "Ground Transportation"
   - Tooltip shows: "Includes taxis, rideshare (Uber/Lyft), rental cars, parking fees"
   - Clicks category
   - Category selector collapses
   - Drawer updates to show classification:
     ```
     โ Tax Classification                                 โ
     โ โ Travel > Ground Transportation                  โ
     โ USA Federal โข Schedule C Line 24a                  โ
     โ Deduction Rate: 100% (fully deductible)            โ
     โ                                                    โ
     โ Classification Notes:                              โ
     โ [Client meeting in downtown SF____________]        โ
     โ                                                    โ
     โ Classified: Oct 15, 2024 3:45 PM                   โ
     โ Method: Manual                                     โ
     โ                                                    โ
     โ [Change Category] [Remove Classification]          โ
     ```

7. **User adds classification notes:**
   - Types: "Client meeting in downtown SF"
   - Notes auto-save (debounced 500ms)
   - Success indicator: "โ Saved"

8. **System records classification:**
   ```json
   {
     "transaction_id": "txn_12345",
     "tax_classification": {
       "category_id": "tax_cat_usa_schedule_c_travel_ground",
       "category_name": "Travel > Ground Transportation",
       "jurisdiction": "usa_federal",
       "deduction_rate": 1.0,
       "classified_at": "2024-10-15T15:45:00Z",
       "classified_by": "user_123",
       "classification_method": "manual",
       "notes": "Client meeting in downtown SF",
       "confidence": null
     }
   }
   ```

9. **User closes drawer:**
   - Transaction row now shows: "โ 100% Deductible" badge (green)
   - Transaction appears in "Categorized" filter
   - Dashboard tax summary updates with +$42.50 to Travel category

**Outcome:** User successfully classified transaction with Schedule C category. Transaction now tracked for tax deduction. Notes preserved for audit trail.

**Duration:** ~2 minutes

**Keyboard Navigation:**
- Tab: Move between search field and category items
- Arrow keys: Navigate category tree
- Enter: Select highlighted category
- Escape: Close selector without selecting

**Screen Reader Support:**
- Announces: "Tax classification dialog, USA Federal Schedule C categories"
- Each category reads: "Travel, Schedule C Line 24a, 100% deductible, expandable"
- Selected category announces: "Ground Transportation selected, 100% deductible"

---

### Journey 2: Accept Auto-Suggested Category (Uber โ Travel)

**Context:** User has previously classified 10 Uber transactions as "Travel > Ground Transportation". A new Uber transaction arrives. System auto-suggests category based on historical pattern.

**Steps:**

1. **Background: Transaction normalized (1.3):**
   - New transaction imported: "UBER *5678 NYC โข -$28.00"
   - Normalization engine extracts: "Uber"
   - Links to counterparty: "Uber"
   - Transaction saved with status: "normalized"

2. **Background: Auto-classification runs:**
   - TaxCategoryClassifier.auto_classify() triggered
   - Checks merchant pattern: "Uber"
   - Finds historical classifications:
     - "Uber" โ "Travel > Ground Transportation" (10 instances)
     - Confidence: 0.95 (above 0.70 threshold)
   - Creates suggestion record

3. **User opens Transaction List:**
   - URL: `/transactions`
   - New transaction appears with special badge:
     ```
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     โ Recent Transactions                [Filters โผ] โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
     โ                                                โ
     โ Oct 20, 2024                                   โ
     โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
     โ โ ๐ก Uber                      -$28.00     โ  โ
     โ โ Chase Business Credit                    โ  โ
     โ โ                                          โ  โ
     โ โ ๐ก Suggested: Travel (95% confidence)    โ  โ
     โ โ Based on 10 similar transactions         โ  โ
     โ โ                                          โ  โ
     โ โ [Accept] [Edit] [Reject]                 โ  โ
     โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
     โ                                                โ
     ```

4. **Auto-suggestion notification appears (real-time):**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ ๐ก Tax Category Suggested                      [ร] โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ We found a likely tax category for your new        โ
   โ transaction based on previous classifications.     โ
   โ                                                    โ
   โ Transaction:                                       โ
   โ Uber โข -$28.00 โข Oct 20, 2024                      โ
   โ                                                    โ
   โ Suggested Category:                                โ
   โ โ Travel > Ground Transportation                  โ
   โ USA Federal โข Schedule C Line 24a                  โ
   โ Deduction Rate: 100% (fully deductible)            โ
   โ                                                    โ
   โ Confidence: 95% โโโโโโโโโโโโโโโโโโโโ               โ
   โ                                                    โ
   โ Based on:                                          โ
   โ โข 10 previous Uber transactions classified         โ
   โ โข 100% accuracy (all classified as Travel)         โ
   โ โข Same merchant pattern                            โ
   โ                                                    โ
   โ [Reject]                       [Accept Category]   โ
   โ                                                    โ
   โ โ Auto-apply this category for future Uber        โ
   โ   transactions (no more suggestions)               โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

5. **User reviews suggestion:**
   - Reads confidence: 95%
   - Reads reasoning: "Based on 10 previous Uber transactions"
   - User thinks: "Yes, this is business travel too"

6. **User accepts suggestion (Option A: Quick accept from list):**
   - Clicks "Accept" button on transaction card
   - Success toast: "โ Transaction classified as Travel"
   - Badge updates: "๐ก Suggested" โ "โ 100% Deductible"
   - Transaction appears in categorized list

7. **User accepts suggestion (Option B: From notification dialog):**
   - Clicks "Accept Category" in notification
   - Checks: "โ Auto-apply this category for future Uber transactions"
   - System creates auto-classification rule:
     ```json
     {
       "rule_id": "rule_uber_to_travel",
       "merchant_pattern": "Uber",
       "category_id": "tax_cat_usa_schedule_c_travel_ground",
       "confidence_boost": 0.10,
       "auto_apply": true,
       "created_at": "2024-10-20T14:30:00Z"
     }
     ```
   - Dialog closes
   - Success toast: "โ Auto-classification enabled for Uber"

8. **Future behavior (auto-apply enabled):**
   - Next Uber transaction: Auto-classifies immediately
   - No suggestion notification shown
   - User can disable auto-apply from Settings > Tax Categories

9. **System logs acceptance:**
   ```json
   {
     "event": "category_suggestion_accepted",
     "transaction_id": "txn_67890",
     "suggested_category_id": "tax_cat_usa_schedule_c_travel_ground",
     "confidence": 0.95,
     "auto_apply_enabled": true,
     "user_id": "user_123",
     "timestamp": "2024-10-20T14:30:15Z"
   }
   ```

**Outcome:** User accepted auto-suggestion with one click. Future Uber transactions will auto-classify without prompts. System learns from user behavior.

**Duration:** ~30 seconds (quick acceptance)

**Alternative Flow: User rejects suggestion:**

6b. **User clicks "Reject":**
   - Suggestion dismissed
   - Transaction returns to "Not categorized" state
   - System logs rejection (confidence adjusted for future)
   - User can manually categorize differently

---

### Journey 3: Upload Factura XML and Link to Mexico Transaction

**Context:** User has a transaction from a Mexican restaurant ($500 MXN) and needs to upload the Factura (CFDI tax receipt) to maintain compliance with SAT regulations.

**Steps:**

1. **Entry point:** User viewing Mexico transaction
   - URL: `/transactions`
   - User sees transaction: "La Casa del Sabor โข -$500 MXN โข Oct 18, 2024"
   - Jurisdiction: Mexico Federal (auto-detected from MXN currency)
   - User clicks transaction to open detail drawer

2. **Transaction detail drawer shows Mexico-specific fields:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Transaction Details                            [ร] โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ La Casa del Sabor                                  โ
   โ Oct 18, 2024                                       โ
   โ                                                    โ
   โ Amount: -$500.00 MXN                               โ
   โ Account: Santander Business                        โ
   โ Counterparty: La Casa del Sabor                    โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
   โ                                                    โ
   โ Tax Classification                                 โ
   โ โช Not categorized yet                             โ
   โ                                                    โ
   โ Jurisdiction: Mexico Federal                       โ
   โ [Change Jurisdiction โผ]                            โ
   โ                                                    โ
   โ [Categorize for Tax Deduction]                     โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
   โ                                                    โ
   โ Factura (CFDI)                                     โ
   โ ๐ No Factura attached                             โ
   โ                                                    โ
   โ โ๏ธ  Recommended: Attach Factura for expenses over  โ
   โ    $2,000 MXN to maintain SAT compliance           โ
   โ                                                    โ
   โ [Attach Factura XML]                               โ
   โ                                                    โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

3. **User clicks "Attach Factura XML":**
   - FacturaUploadDialog opens as modal
   - Modal size: 600px width, auto height

4. **Factura upload dialog appears:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Attach Factura (CFDI)                          [ร] โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ Transaction: La Casa del Sabor โข $500 MXN          โ
   โ Date: Oct 18, 2024                                 โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ                                                    โ
   โ Upload Factura XML:                                โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ                                              โ  โ
   โ โ              ๐                              โ  โ
   โ โ                                              โ  โ
   โ โ      Drag and drop XML file here             โ  โ
   โ โ      or click to browse                      โ  โ
   โ โ                                              โ  โ
   โ โ      Accepted: CFDI 3.3, CFDI 4.0 (.xml)     โ  โ
   โ โ      Max size: 5MB                           โ  โ
   โ โ                                              โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ                                                    โ
   โ โน๏ธ  What's a Factura?                              โ
   โ Factura (CFDI) is a Mexican tax receipt required   โ
   โ by SAT for business expense deductions. Request    โ
   โ from merchants at time of purchase.                โ
   โ                                                    โ
   โ [Cancel]                                           โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

5. **User drags factura_abc123.xml file:**
   - File drag enters drop zone
   - Drop zone highlights (blue border, light blue background)
   - User releases file

6. **File upload and parsing begins:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Attach Factura (CFDI)                          [ร] โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ Transaction: La Casa del Sabor โข $500 MXN          โ
   โ Date: Oct 18, 2024                                 โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ                                                    โ
   โ Processing Factura...                              โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ ๐ factura_abc123.xml (4.2 KB)               โ  โ
   โ โ                                              โ  โ
   โ โ [โโโโโโโโโโโโโโโโโโโโ] 60%                   โ  โ
   โ โ                                              โ  โ
   โ โ โ XML format valid (CFDI 4.0)               โ  โ
   โ โ โ RFC format valid                          โ  โ
   โ โ โณ Validating UUID with SAT...               โ  โ
   โ โ โณ Checking amount match...                  โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ                                                    โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

7. **Validation completes successfully:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Attach Factura (CFDI)                          [ร] โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ Transaction: La Casa del Sabor โข $500 MXN          โ
   โ Date: Oct 18, 2024                                 โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ                                                    โ
   โ โ Factura validated successfully                  โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ ๐ factura_abc123.xml                        โ  โ
   โ โ                                              โ  โ
   โ โ RFC: ABC123456XYZ                            โ  โ
   โ โ UUID: 12345678-1234-1234-1234-123456789012   โ  โ
   โ โ Issued: Oct 18, 2024                         โ  โ
   โ โ Amount: $500.00 MXN                          โ  โ
   โ โ                                              โ  โ
   โ โ โ Amount matches transaction                โ  โ
   โ โ โ Date within window (same day)             โ  โ
   โ โ โ RFC format valid                          โ  โ
   โ โ โ UUID verified with SAT                    โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ                                                    โ
   โ [Cancel]                        [Attach Factura]   โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

8. **User clicks "Attach Factura":**
   - System creates FacturaRecord
   - Links to transaction
   - Stores XML in file artifacts
   - Modal closes with success animation
   - Success toast: "โ Factura attached successfully"

9. **Transaction drawer updates to show Factura:**
   ```
   โ Factura (CFDI)                                     โ
   โ โ Factura attached                                โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ ๐ factura_abc123.xml                        โ  โ
   โ โ                                              โ  โ
   โ โ RFC: ABC123456XYZ                            โ  โ
   โ โ UUID: 12345678-1234-1234-1234-123456789012   โ  โ
   โ โ Issued: Oct 18, 2024                         โ  โ
   โ โ Amount: $500.00 MXN                          โ  โ
   โ โ Status: Valid โ                             โ  โ
   โ โ                                              โ  โ
   โ โ [Download XML] [Download PDF] [Unlink]       โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   ```

10. **User can download Factura anytime:**
    - Clicks "Download XML" โ Original XML file downloads
    - Clicks "Download PDF" โ System-generated PDF representation downloads

**Outcome:** User successfully uploaded and linked Factura to Mexico transaction. SAT compliance maintained. Factura details preserved for audit.

**Duration:** ~3 minutes

**Error Handling Examples:**

**Error: Amount mismatch (5% variance):**
```
โ โ๏ธ  Validation issues detected                    โ
โ                                                    โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ ๐ factura_abc123.xml                        โ  โ
โ โ                                              โ  โ
โ โ โ๏ธ  Amount mismatch                          โ  โ
โ โ Transaction: $500.00 MXN                     โ  โ
โ โ Factura: $520.00 MXN                         โ  โ
โ โ Variance: +$20.00 (4%)                       โ  โ
โ โ                                              โ  โ
โ โ โ This may be due to tips, taxes, or fees   โ  โ
โ โ   not included in transaction amount.        โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                    โ
โ [Cancel]   [Force Link Anyway]   [Edit Amount]     โ
```

**Error: RFC format invalid:**
```
โ โ Validation failed                              โ
โ                                                    โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ ๐ factura_abc123.xml                        โ  โ
โ โ                                              โ  โ
โ โ โ RFC format invalid                        โ  โ
โ โ Found: INVALID123                            โ  โ
โ โ Expected: 12-13 alphanumeric characters      โ  โ
โ โ                                              โ  โ
โ โ โ UUID not found in SAT database            โ  โ
โ โ                                              โ  โ
โ โ โ Please verify XML file is valid CFDI      โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                    โ
โ [Cancel]                       [Try Another File]  โ
```

---

### Journey 4: Create Custom Tax Category

**Context:** User needs a custom category for "Social Media Advertising" expenses under Mexico SAT "Gastos de Gestiรณn" (Management Expenses). System categories don't include this specific subcategory.

**Steps:**

1. **Entry point:** User opens Tax Category Manager
   - URL: `/settings/tax-categories`
   - User sees system categories organized by jurisdiction

2. **Tax Category Manager displays:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Tax Categories                     [+ New Category] โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ Search categories... [____________] ๐             โ
   โ Jurisdiction: [All โผ]                              โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
   โ                                                    โ
   โ USA FEDERAL - SCHEDULE C (25 categories)           โ
   โ                                                    โ
   โ โพ Travel (Line 24a)                    100%       โ
   โ   โโ Air Travel                        100%  ๐    โ
   โ   โโ Ground Transportation             100%  ๐    โ
   โ   โโ Lodging                           100%  ๐    โ
   โ   โโ Other Travel Expenses             100%  ๐    โ
   โ โธ Meals (Business) (Line 24b)           50%       โ
   โ โธ Office Expenses (Line 18)            100%       โ
   โ โธ Advertising (Line 8)                 100%       โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
   โ                                                    โ
   โ MEXICO FEDERAL - SAT (18 categories)               โ
   โ                                                    โ
   โ โพ Gastos de Gestiรณn                    100%       โ
   โ   โโ Publicidad y Promociรณn            100%  ๐    โ
   โ   โโ Arrendamientos                    100%  ๐    โ
   โ   โโ Otros Gastos                      100%  ๐    โ
   โ โธ Gastos de Representaciรณn              50%       โ
   โ โธ Inversiones                          100%       โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
   โ                                                    โ
   โ CUSTOM CATEGORIES (3)                              โ
   โ                                                    โ
   โ โธ Software Subscriptions (USA)         100%  โ๏ธ   โ
   โ โธ Client Gifts (USA)                     0%  โ๏ธ   โ
   โ โธ Gastos de Marketing Digital (MX)     100%  โ๏ธ   โ
   โ                                                    โ
   โ ๐ = System category (read-only)                   โ
   โ โ๏ธ = Custom category (editable)                    โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

3. **User clicks "+ New Category" button:**
   - Create Category modal opens
   - Focus on "Category Name" field

4. **Create Custom Category modal appears:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Create Custom Tax Category                     [ร] โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ                                                    โ
   โ Jurisdiction *                                     โ
   โ โฆฟ USA Federal    โ Mexico Federal                  โ
   โ                                                    โ
   โ Category Name *                                    โ
   โ [_________________________________________]        โ
   โ                                                    โ
   โ Parent Category (optional)                         โ
   โ [Select parent category โผ]                         โ
   โ โ Leave blank for top-level category              โ
   โ                                                    โ
   โ SAT Code (optional, Mexico only)                   โ
   โ [________] (8 digits)                              โ
   โ โ Official SAT product/service code                โ
   โ                                                    โ
   โ Deduction Rate *                                   โ
   โ [Fully Deductible (100%) โผ]                        โ
   โ โข Fully Deductible (100%)                          โ
   โ โข Partially Deductible (50%)                       โ
   โ โข Not Deductible (0%)                              โ
   โ โข Custom Percentage...                             โ
   โ                                                    โ
   โ Description (optional)                             โ
   โ [_________________________________________]        โ
   โ [_________________________________________]        โ
   โ                                                    โ
   โ [Cancel]                       [Create Category]   โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

5. **User selects Mexico Federal:**
   - Clicks "โ Mexico Federal" radio button
   - SAT Code field becomes enabled (shown in previous step)
   - Parent category dropdown updates to show Mexico categories

6. **User fills category information:**
   - Types name: "Gastos de Publicidad en Redes Sociales"
   - Selects parent: "Gastos de Gestiรณn"
   - Types SAT code: "84111506"
   - Selects deduction rate: "Fully Deductible (100%)"
   - Types description: "Social media advertising expenses (Facebook, Instagram, LinkedIn, Twitter)"

7. **Form shows real-time validation:**
   ```
   โ Category Name *                                    โ
   โ [Gastos de Publicidad en Redes Sociales____]      โ
   โ โ Name available                                  โ
   โ                                                    โ
   โ Parent Category                                    โ
   โ [Gastos de Gestiรณn โผ]                              โ
   โ                                                    โ
   โ SAT Code (optional)                                โ
   โ [84111506]                                         โ
   โ โ Valid SAT code format                           โ
   โ                                                    โ
   โ Deduction Rate *                                   โ
   โ [Fully Deductible (100%) โผ]                        โ
   โ                                                    โ
   โ Description                                        โ
   โ [Social media advertising expenses (Facebook,      โ
   โ  Instagram, LinkedIn, Twitter)_____________]       โ
   ```

8. **User clicks "Create Category":**
   - System validates all fields
   - Creates custom category with ID: `tax_cat_mx_sat_custom_social_ads`
   - Modal closes with success animation
   - Success toast: "โ Custom category created: Gastos de Publicidad en Redes Sociales"

9. **Category Manager updates to show new category:**
   ```
   โ MEXICO FEDERAL - SAT (18 categories)               โ
   โ                                                    โ
   โ โพ Gastos de Gestiรณn                    100%       โ
   โ   โโ Publicidad y Promociรณn            100%  ๐    โ
   โ   โโ Arrendamientos                    100%  ๐    โ
   โ   โโ Otros Gastos                      100%  ๐    โ
   โ   โโ Gastos de Publicidad en Redes     100%  โ๏ธ    โ
   โ       Sociales (Custom)                            โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
   โ                                                    โ
   โ CUSTOM CATEGORIES (4)                              โ
   โ                                                    โ
   โ โธ Software Subscriptions (USA)         100%  โ๏ธ   โ
   โ โธ Client Gifts (USA)                     0%  โ๏ธ   โ
   โ โธ Gastos de Marketing Digital (MX)     100%  โ๏ธ   โ
   โ โธ Gastos de Publicidad en Redes        100%  โ๏ธ   โ
   โ   Sociales (MX)                                    โ
   โ     [Edit] [Archive]                               โ
   ```

10. **User can now use custom category:**
    - Category appears in TaxCategorySelector dropdown
    - Shows under parent "Gastos de Gestiรณn > Custom"
    - Available for classifying transactions
    - User thinks: "Perfect! Now I can track social media ads separately."

**Outcome:** User successfully created custom tax category for Mexico SAT. Category is now available for transaction classification and will appear in tax reports.

**Duration:** ~3 minutes

**Validation Errors:**

**Duplicate name:**
```
โ Category Name *                                    โ
โ [Publicidad y Promociรณn_________________]          โ
โ โ Name already exists in Mexico Federal           โ
โ โ Try: "Publicidad Online" or "Promociรณn Digital" โ
```

**Invalid SAT code:**
```
โ SAT Code (optional)                                โ
โ [1234567]                                          โ
โ โ Invalid SAT code (must be 8 digits)             โ
```

---

### Journey 5: Bulk Classify Uncategorized Transactions

**Context:** User has 47 uncategorized transactions from the past month. They want to classify multiple similar transactions at once instead of one-by-one.

**Steps:**

1. **Entry point:** User viewing Transaction List
   - URL: `/transactions`
   - Filter: "Status: Not Categorized" (47 transactions)
   - User sees many similar transactions (multiple Starbucks, multiple Amazon)

2. **Transaction List shows bulk selection mode:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Transactions                          [Filters โผ]  โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ Status: Not Categorized (47)                       โ
   โ                                                    โ
   โ [โ Select All] [Bulk Actions โผ]                    โ
   โ                                                    โ
   โ Oct 2024                                           โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ โ Oct 23  Starbucks           -$5.75         โ  โ
   โ โ           Chase Credit                       โ  โ
   โ โ           โช Not categorized                  โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ โ Oct 22  Amazon               -$129.99      โ  โ
   โ โ           Chase Credit                       โ  โ
   โ โ           โช Not categorized                  โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ โ Oct 21  Starbucks           -$4.25         โ  โ
   โ โ           Chase Credit                       โ  โ
   โ โ           โช Not categorized                  โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ โ Oct 20  Uber                -$28.00        โ  โ
   โ โ           Chase Credit                       โ  โ
   โ โ           โช Not categorized                  โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ โ Oct 19  Starbucks           -$6.50         โ  โ
   โ โ           Chase Credit                       โ  โ
   โ โ           โช Not categorized                  โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ                                                    โ
   โ ... and 42 more                                    โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

3. **User selects all Starbucks transactions:**
   - Clicks checkbox on first Starbucks transaction
   - Holds Shift, clicks checkbox on third Starbucks transaction
   - All Starbucks transactions between selected (8 total)
   - Bottom toolbar slides up:
     ```
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     โ                                                    โ
     โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
     โ 8 transactions selected                            โ
     โ                                                    โ
     โ [Deselect All] [Bulk Classify] [Select Similar]   โ
     โ                                                    โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     ```

4. **User clicks "Bulk Classify":**
   - Bulk Classification Dialog opens
   - Shows preview of selected transactions

5. **Bulk Classification Dialog appears:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Bulk Classify Transactions                     [ร] โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ You're about to classify 8 transactions            โ
   โ                                                    โ
   โ Selected Transactions:                             โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ Oct 23  Starbucks           -$5.75           โ  โ
   โ โ Oct 21  Starbucks           -$4.25           โ  โ
   โ โ Oct 19  Starbucks           -$6.50           โ  โ
   โ โ Oct 18  Starbucks           -$5.00           โ  โ
   โ โ Oct 16  Starbucks           -$7.25           โ  โ
   โ โ Oct 14  Starbucks           -$4.75           โ  โ
   โ โ Oct 12  Starbucks           -$5.50           โ  โ
   โ โ Oct 10  Starbucks           -$6.00           โ  โ
   โ โ                                              โ  โ
   โ โ Total: $45.00                                โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ                                                    โ
   โ Apply Tax Category:                                โ
   โ [Select category_________________________] ๐      โ
   โ                                                    โ
   โ Jurisdiction: USA Federal (all transactions)       โ
   โ                                                    โ
   โ Classification Notes (optional):                   โ
   โ [Apply same notes to all transactions_______]      โ
   โ [_________________________________________]        โ
   โ                                                    โ
   โ [Cancel]                        [Classify All 8]   โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

6. **User selects category:**
   - Clicks category dropdown
   - Types: "meals"
   - Selects: "Meals (Business) (Schedule C Line 24b) โข 50%"
   - Category field shows selection:
     ```
     โ Apply Tax Category:                                โ
     โ [Meals (Business) โข 50% deductible_________] ๐    โ
     ```

7. **User adds notes:**
   - Types: "Client meetings at local Starbucks"
   - Notes will be applied to all 8 transactions

8. **User clicks "Classify All 8":**
   - Progress indicator appears:
     ```
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     โ Classifying Transactions...                        โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
     โ                                                    โ
     โ [โโโโโโโโโโโโโโโโโโโโโโ] 8 of 8 (100%)             โ
     โ                                                    โ
     โ โ Oct 23  Starbucks           -$5.75              โ
     โ โ Oct 21  Starbucks           -$4.25              โ
     โ โ Oct 19  Starbucks           -$6.50              โ
     โ โ Oct 18  Starbucks           -$5.00              โ
     โ โ Oct 16  Starbucks           -$7.25              โ
     โ โ Oct 14  Starbucks           -$4.75              โ
     โ โ Oct 12  Starbucks           -$5.50              โ
     โ โ Oct 10  Starbucks           -$6.00              โ
     โ                                                    โ
     โ Processing complete!                               โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     ```
   - Auto-closes after 1 second
   - Success toast: "โ 8 transactions classified as Meals"

9. **Transaction List updates:**
   - All Starbucks transactions now show "โ 50% Deductible" badge
   - Filter count updates: "Not Categorized (39)" (was 47)
   - Checkboxes deselected
   - Bottom toolbar dismisses

10. **User can continue bulk classifying:**
    - Selects 5 Amazon transactions
    - Clicks "Bulk Classify"
    - Assigns to "Office Expenses โข 100%"
    - User thinks: "This is so much faster than one-by-one!"

**Outcome:** User successfully classified 8 transactions at once. Saved significant time compared to manual classification. Can continue with remaining uncategorized transactions.

**Duration:** ~4 minutes for 8 transactions (~30 seconds per transaction)

**Alternative: "Select Similar" Feature:**

3b. **User clicks "Select Similar" button:**
   - System analyzes selected transaction: "Starbucks"
   - Automatically selects all other Starbucks transactions (8 total)
   - Toolbar updates: "8 similar transactions selected"
   - User can proceed directly to bulk classify

**Edge Case: Mixed Jurisdictions:**
```
โ โ๏ธ  Selected transactions have mixed jurisdictions    โ
โ                                                        โ
โ โข 5 transactions: USA Federal                          โ
โ โข 3 transactions: Mexico Federal                       โ
โ                                                        โ
โ โ You can only bulk classify transactions from the    โ
โ   same jurisdiction. Please select one:                โ
โ                                                        โ
โ [Classify USA (5)] [Classify Mexico (3)] [Cancel]      โ
```

---

### Journey 6: Handle Factura Amount Mismatch (Force Link)

**Context:** User has a Mexico transaction for $1,500 MXN but the uploaded Factura shows $1,550 MXN (3.3% variance). This may be due to tips, taxes, or fees not included in the bank transaction.

**Steps:**

1. **Background: User uploads Factura with amount mismatch:**
   - Transaction amount: $1,500 MXN
   - Factura amount: $1,550 MXN
   - Variance: +$50 MXN (3.3%)

2. **Validation detects mismatch:**
   ```
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ Attach Factura (CFDI)                          [ร] โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ Transaction: Ferreterรญa ABC โข $1,500 MXN           โ
   โ Date: Oct 22, 2024                                 โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ                                                    โ
   โ โ๏ธ  Validation warning                             โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ ๐ factura_ferreteria_abc.xml                โ  โ
   โ โ                                              โ  โ
   โ โ RFC: FER123456ABC                            โ  โ
   โ โ UUID: 98765432-9876-9876-9876-987654321098   โ  โ
   โ โ Issued: Oct 22, 2024                         โ  โ
   โ โ Amount: $1,550.00 MXN                        โ  โ
   โ โ                                              โ  โ
   โ โ โ๏ธ  Amount mismatch detected                 โ  โ
   โ โ                                              โ  โ
   โ โ Transaction:  $1,500.00 MXN                  โ  โ
   โ โ Factura:      $1,550.00 MXN                  โ  โ
   โ โ Variance:     +$50.00 (3.3%)                 โ  โ
   โ โ                                              โ  โ
   โ โ โ Date matches (same day)                   โ  โ
   โ โ โ RFC format valid                          โ  โ
   โ โ โ UUID verified with SAT                    โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ                                                    โ
   โ โ Possible reasons for variance:                   โ
   โ โข Tips not included in transaction amount          โ
   โ โข Separate tax/fee charges                         โ
   โ โข Partial payment (transaction split)              โ
   โ                                                    โ
   โ What would you like to do?                         โ
   โ                                                    โ
   โ [Cancel]  [Adjust Transaction]  [Force Link]       โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   ```

3. **User reviews options:**
   - **Cancel:** Abandon Factura upload
   - **Adjust Transaction:** Update transaction amount to match Factura ($1,550)
   - **Force Link:** Accept mismatch and link anyway (logs variance)

4. **User clicks "Adjust Transaction":**
   - Adjustment dialog appears:
     ```
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     โ Adjust Transaction Amount                      [ร] โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
     โ                                                    โ
     โ Update transaction to match Factura amount?        โ
     โ                                                    โ
     โ Current Transaction:                               โ
     โ Ferreterรญa ABC โข Oct 22, 2024                      โ
     โ Amount: $1,500.00 MXN                              โ
     โ                                                    โ
     โ Factura Amount:                                    โ
     โ $1,550.00 MXN                                      โ
     โ                                                    โ
     โ Adjustment: +$50.00                                โ
     โ                                                    โ
     โ โ๏ธ  This will modify the original transaction      โ
     โ    amount to match the Factura. The original       โ
     โ    amount ($1,500) will be preserved in the        โ
     โ    transaction history.                            โ
     โ                                                    โ
     โ Reason for adjustment:                             โ
     โ [Factura includes tip/tax not in bank record_]     โ
     โ                                                    โ
     โ [Cancel]                      [Adjust & Link]      โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     ```

5. **User types adjustment reason:**
   - Types: "Factura includes IVA tax ($50), bank shows net amount only"
   - Clicks "Adjust & Link"

6. **System performs adjustment:**
   - Creates adjustment record:
     ```json
     {
       "adjustment_id": "adj_123",
       "transaction_id": "txn_67890",
       "original_amount": 1500.00,
       "adjusted_amount": 1550.00,
       "adjustment_type": "factura_reconciliation",
       "reason": "Factura includes IVA tax ($50), bank shows net amount only",
       "created_at": "2024-10-22T16:20:00Z"
     }
     ```
   - Updates transaction amount: $1,500 โ $1,550
   - Links Factura (now amounts match)
   - Success toast: "โ Transaction adjusted and Factura attached"

7. **Transaction drawer shows adjustment history:**
   ```
   โ Transaction Details                                โ
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
   โ Ferreterรญa ABC                                     โ
   โ Oct 22, 2024                                       โ
   โ                                                    โ
   โ Amount: -$1,550.00 MXN                             โ
   โ โ๏ธ  Adjusted from $1,500.00                        โ
   โ [View Adjustment History]                          โ
   โ                                                    โ
   โ Account: Santander Business                        โ
   โ Counterparty: Ferreterรญa ABC                       โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
   โ                                                    โ
   โ Factura (CFDI)                                     โ
   โ โ Factura attached                                โ
   โ                                                    โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   โ โ ๐ factura_ferreteria_abc.xml                โ  โ
   โ โ                                              โ  โ
   โ โ RFC: FER123456ABC                            โ  โ
   โ โ UUID: 98765432-9876-9876-9876-987654321098   โ  โ
   โ โ Issued: Oct 22, 2024                         โ  โ
   โ โ Amount: $1,550.00 MXN                        โ  โ
   โ โ Status: Valid โ (Amount adjusted)           โ  โ
   โ โ                                              โ  โ
   โ โ [Download XML] [Download PDF] [Unlink]       โ  โ
   โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
   ```

**Alternative Flow: Force Link Without Adjustment:**

4b. **User clicks "Force Link":**
   - Confirmation dialog appears:
     ```
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     โ Force Link Factura                             [ร] โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
     โ                                                    โ
     โ Link Factura despite amount mismatch?              โ
     โ                                                    โ
     โ Transaction: $1,500.00 MXN                         โ
     โ Factura:     $1,550.00 MXN                         โ
     โ Variance:    +$50.00 (3.3%)                        โ
     โ                                                    โ
     โ โ๏ธ  The transaction amount will NOT be changed.    โ
     โ    The variance will be logged for your records.   โ
     โ                                                    โ
     โ Reason for variance:                               โ
     โ [Optional explanation_____________________]        โ
     โ                                                    โ
     โ [Cancel]                          [Force Link]     โ
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     ```
   - User types reason: "IVA included in Factura, not in bank"
   - Clicks "Force Link"
   - Factura linked with variance logged
   - Transaction amount unchanged ($1,500)

**Outcome:** User successfully resolved amount mismatch by adjusting transaction to match Factura. Adjustment history preserved for audit trail. Alternative: Force link without adjustment if user prefers.

**Duration:** ~2 minutes

---

## Wireframes

### Wireframe 1: TaxCategorySelector Dropdown (Hierarchical Display)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Tax Category                                              [ร]  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ Search categories...  [travel_______________] ๐  [Clear]      โ
โ                                                                โ
โ Jurisdiction: [USA Federal โผ]                                  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ SEARCH RESULTS (4)                                             โ
โ                                                                โ
โ โพ Travel (Line 24a)                              100%  [?]    โ
โ   โ                                                            โ
โ   โโ Air Travel                                  100%  [?]    โ
โ   โ  โ Flights, airline fees, baggage charges                 โ
โ   โ  [Select]                                                 โ
โ   โ                                                            โ
โ   โโ Ground Transportation โโโโโโโโโโโโโโโโโโโ   100%  [?]    โ
โ   โ  โ Taxis, rideshare (Uber/Lyft),         โ                โ
โ   โ    rental cars, parking, tolls            โ                โ
โ   โ  [Select] โโโโโโโโโโโโโโโโ HIGHLIGHTED โโโโ                โ
โ   โ                                                            โ
โ   โโ Lodging                                    100%  [?]    โ
โ   โ  โ Hotels, Airbnb, business travel lodging               โ
โ   โ  [Select]                                                 โ
โ   โ                                                            โ
โ   โโ Other Travel Expenses                      100%  [?]    โ
โ      โ Meals while traveling, tips, misc expenses             โ
โ      [Select]                                                 โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ LEGEND:                                                        โ
โ 100% = Fully deductible    50% = Partially deductible         โ
โ 0% = Not deductible        [?] = View IRS guidelines          โ
โ                                                                โ
โ [Cancel]                                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

INTERACTION NOTES:
- Search field: Live filter as user types (debounced 300ms)
- Category tree: Click parent to expand/collapse children
- Hover effect: Light blue background on category rows
- Deduction rate badge: Color-coded (green=100%, yellow=50%, gray=0%)
- [?] icon: Tooltip with IRS/SAT guidelines for category
- Keyboard: Tab through categories, Enter to select, Escape to close
- Screen reader: "Ground Transportation, child of Travel, 100% deductible"

RESPONSIVE DESIGN:
- Desktop: Fixed width 600px, max height 70vh, scrollable
- Tablet: Full width minus 32px margin
- Mobile: Full screen modal with native scroll

EMPTY STATE:
If search returns no results:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ No categories match "xyz"                      โ
โ                                                โ
โ Try:                                           โ
โ โข Different search terms                       โ
โ โข Check spelling                               โ
โ โข Browse all categories (clear search)         โ
โ                                                โ
โ [Clear Search] [Create Custom Category]        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### Wireframe 2: Auto-Suggestion Notification (Confidence Score)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ก Tax Category Suggested                                 [ร]  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ We found a likely tax category for your transaction           โ
โ based on previous classifications.                             โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ TRANSACTION                                                    โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ Uber โข -$28.00 โข Oct 20, 2024                            โ  โ
โ โ Chase Business Credit                                    โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ SUGGESTED CATEGORY                                             โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ โ Travel > Ground Transportation                        โ  โ
โ โ USA Federal โข Schedule C Line 24a                        โ  โ
โ โ Deduction Rate: 100% (fully deductible)                  โ  โ
โ โ                                                          โ  โ
โ โ CONFIDENCE SCORE                                         โ  โ
โ โ 95% โโโโโโโโโโโโโโโโโโโโโ Very High                      โ  โ
โ โ                                                          โ  โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ  โ
โ โ WHY THIS SUGGESTION?                                     โ  โ
โ โ โข 10 previous Uber transactions classified as Travel     โ  โ
โ โ โข 100% accuracy (all Uber โ Travel)                      โ  โ
โ โ โข Same merchant pattern detected                         โ  โ
โ โ โข Same account (Chase Business Credit)                   โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ OPTIONS                                                        โ
โ                                                                โ
โ โ Auto-apply this category for future Uber transactions       โ
โ   (no more suggestions - categorize automatically)            โ
โ                                                                โ
โ โ Add classification notes                                    โ
โ   [Optional: reason for this classification_____________]      โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ [Reject Suggestion]                     [โ Accept Category]   โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

VISUAL DESIGN:
- Confidence bar: Color gradient (red 0-50%, yellow 50-70%, green 70-100%)
- 95% = Very High, 80-94% = High, 70-79% = Medium, <70% = Low (not shown)
- Icon: ๐ก for suggestions, โ for accepted, โ for rejected

INTERACTION:
- Auto-dismiss: Never (requires user action)
- Keyboard: Tab to buttons, Enter to accept, Escape to dismiss (reject)
- Screen reader: "Tax category suggestion. Confidence: 95 percent, very high"

LOADING STATE:
While checking for suggestion:
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ก Checking for tax category suggestions...    โ
โ [Spinner animation] Please wait               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### Wireframe 3: Transaction Detail with Tax Classification Badge

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Transaction Details                                        [ร] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ TRANSACTION HEADER                                       โ  โ
โ โ                                                          โ  โ
โ โ Uber                                                     โ  โ
โ โ Oct 15, 2024 โข 2:45 PM                                   โ  โ
โ โ                                                          โ  โ
โ โ -$42.50                โ 100% Deductible โโโ BADGE      โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ BASIC INFORMATION                                              โ
โ Account:       Chase Business Credit                           โ
โ Counterparty:  Uber                                            โ
โ Status:        Cleared                                         โ
โ Normalized:    Yes โ                                           โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ TAX CLASSIFICATION                                             โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ โ Travel > Ground Transportation                        โ  โ
โ โ USA Federal โข Schedule C Line 24a                        โ  โ
โ โ                                                          โ  โ
โ โ Deduction Rate:  100% (fully deductible)                 โ  โ
โ โ Deductible Amount: $42.50                                โ  โ
โ โ                                                          โ  โ
โ โ Classification Notes:                                    โ  โ
โ โ Client meeting in downtown SF                            โ  โ
โ โ                                                          โ  โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ  โ
โ โ Classified: Oct 15, 2024 3:45 PM                         โ  โ
โ โ Method: Manual                                           โ  โ
โ โ By: You                                                  โ  โ
โ โ                                                          โ  โ
โ โ [Change Category] [Remove Classification]                โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ FACTURA (CFDI)                                                 โ
โ ๐ No Factura attached (USA transaction)                       โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ NOTES                                                          โ
โ [Add additional notes about this transaction___________]       โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

BADGE VARIATIONS:
โ 100% Deductible  (green background, white text)
โ๏ธ  50% Deductible  (yellow background, dark text)
โญ 0% Deductible    (gray background, dark text)
โช Not categorized  (white background, gray border, gray text)
๐ก Suggested       (blue background, white text)

RESPONSIVE DESIGN:
- Desktop: Drawer 480px width, slides from right
- Tablet: Drawer 400px width
- Mobile: Full screen modal, slides from bottom

KEYBOARD NAVIGATION:
- Tab: Move between interactive elements
- Enter: Activate buttons
- Escape: Close drawer

SCREEN READER:
- Badge announces: "Tax classification: 100% deductible, Travel, Ground Transportation"
- Reads full path: "USA Federal, Schedule C Line 24a"
```

---

### Wireframe 4: TaxCategoryManager Tree View (System vs Custom)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Tax Categories                             [+ New Category]    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ Search categories...  [____________] ๐   [Clear]              โ
โ                                                                โ
โ Jurisdiction: [All โผ]     Sort: [Alphabetical โผ]               โ
โ โ Show archived categories                                     โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ โพ USA FEDERAL - SCHEDULE C (25 categories) โโโโโโโโโโโ ๐     โ
โ   โ                                                            โ
โ   โโ โธ Advertising (Line 8)                     100%  ๐      โ
โ   โ                                                            โ
โ   โโ โธ Car and Truck Expenses (Line 9)          100%  ๐      โ
โ   โ                                                            โ
โ   โโ โธ Legal and Professional (Line 17)         100%  ๐      โ
โ   โ                                                            โ
โ   โโ โพ Meals (Business) (Line 24b)               50%  ๐      โ
โ   โ   โโ Meals with Clients                      50%  ๐      โ
โ   โ                                                            โ
โ   โโ โธ Office Expenses (Line 18)                100%  ๐      โ
โ   โ                                                            โ
โ   โโ โพ Travel (Line 24a)                        100%  ๐      โ
โ   โ   โโ Air Travel                             100%  ๐      โ
โ   โ   โโ Ground Transportation                  100%  ๐      โ
โ   โ   โโ Lodging                                100%  ๐      โ
โ   โ   โโ Other Travel Expenses                  100%  ๐      โ
โ   โ                                                            โ
โ   โโ โธ Utilities (Line 25)                      100%  ๐      โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ โพ MEXICO FEDERAL - SAT (18 categories) โโโโโโโโโโโโโโ ๐      โ
โ   โ                                                            โ
โ   โโ โพ Gastos de Gestiรณn                        100%  ๐      โ
โ   โ   โโ Publicidad y Promociรณn                 100%  ๐      โ
โ   โ   โโ Arrendamientos                         100%  ๐      โ
โ   โ   โโ Otros Gastos                           100%  ๐      โ
โ   โ   โโ Gastos de Publicidad en Redes          100%  โ๏ธ      โ
โ   โ       Sociales (CUSTOM)                                    โ
โ   โ       [Edit] [Archive]                                     โ
โ   โ                                                            โ
โ   โโ โธ Gastos de Representaciรณn                  50%  ๐      โ
โ   โ                                                            โ
โ   โโ โธ Inversiones                              100%  ๐      โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ โพ CUSTOM CATEGORIES (4) โโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ๏ธ       โ
โ   โ                                                            โ
โ   โโ Software Subscriptions (USA Federal)       100%  โ๏ธ      โ
โ   โ   12 transactions โข Created Oct 1, 2024                    โ
โ   โ   [Edit] [Archive] [View Transactions]                     โ
โ   โ                                                            โ
โ   โโ Client Gifts (USA Federal)                   0%  โ๏ธ      โ
โ   โ   3 transactions โข Created Oct 5, 2024                     โ
โ   โ   [Edit] [Archive] [View Transactions]                     โ
โ   โ                                                            โ
โ   โโ Gastos de Marketing Digital (Mexico)       100%  โ๏ธ      โ
โ   โ   8 transactions โข Created Oct 10, 2024                    โ
โ   โ   [Edit] [Archive] [View Transactions]                     โ
โ   โ                                                            โ
โ   โโ Gastos de Publicidad en Redes (Mexico)     100%  โ๏ธ      โ
โ       Sociales                                                 โ
โ       0 transactions โข Created Oct 15, 2024                    โ
โ       [Edit] [Archive]                                         โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ LEGEND:                                                        โ
โ ๐ = System category (read-only)                               โ
โ โ๏ธ = Custom category (editable)                                โ
โ 100% = Fully deductible    50% = Partially    0% = Not        โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

INTERACTION:
- Click category name: Expand/collapse children
- Hover: Highlight row with light background
- System categories: No edit/delete buttons (read-only)
- Custom categories: Show edit/archive buttons
- Drag-and-drop: Reorder custom categories (not system)

KEYBOARD NAVIGATION:
- Arrow keys: Navigate tree
- Space: Expand/collapse category
- Enter: Edit selected custom category
- Delete: Archive selected custom category (with confirmation)

EMPTY STATE (no custom categories):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ No custom categories yet                       โ
โ                                                โ
โ Create custom categories to track expenses     โ
โ specific to your business needs.               โ
โ                                                โ
โ [+ Create First Custom Category]               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### Wireframe 5: Create Custom Category Modal

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Create Custom Tax Category                                [ร] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ JURISDICTION *                                                 โ
โ โฆฟ USA Federal    โ Mexico Federal                              โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ CATEGORY NAME *                                                โ
โ [Social Media Advertising_____________________________]        โ
โ โ Name available                                              โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ PARENT CATEGORY (optional)                                     โ
โ [Select parent category โผ]                                     โ
โ โ Leave blank for top-level category, or nest under existing  โ
โ   category for better organization                             โ
โ                                                                โ
โ Currently selected: Advertising (Schedule C Line 8)            โ
โ Full path: USA Federal > Advertising > Social Media Ads        โ
โ                                                                โ
โ [Clear Selection]                                              โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ SAT CODE (optional, Mexico only)                               โ
โ [________] (8 digits)                                          โ
โ โ Official SAT product/service code for Mexican tax filings   โ
โ (Grayed out for USA jurisdiction)                              โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ DEDUCTION RATE *                                               โ
โ [Fully Deductible (100%) โผ]                                    โ
โ                                                                โ
โ Options:                                                       โ
โ โข Fully Deductible (100%) โ Most business expenses            โ
โ โข Partially Deductible (50%) โ Business meals, entertainment  โ
โ โข Not Deductible (0%) โ Personal expenses                     โ
โ โข Custom Percentage... โ Specify exact percentage             โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ DESCRIPTION (optional)                                         โ
โ [Expenses for social media advertising campaigns including     โ
โ  Facebook, Instagram, LinkedIn, Twitter, and other platforms]  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ 180 characters remaining                                       โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ โ Custom categories are visible only to you and can be        โ
โ   edited or archived at any time.                              โ
โ                                                                โ
โ [Cancel]                                  [Create Category]    โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

VALIDATION STATES:

NAME FIELD - Available:
[Social Media Advertising_____________________________]
โ Name available

NAME FIELD - Duplicate:
[Advertising_________________________________________]
โ Name already exists in USA Federal
โ Try: "Online Advertising" or "Digital Advertising"

NAME FIELD - Invalid:
[_________________________________________________]
โ Category name is required

SAT CODE - Valid (Mexico):
[84111506]
โ Valid SAT code format

SAT CODE - Invalid (Mexico):
[1234567]
โ Invalid SAT code (must be 8 digits)

LOADING STATE (while creating):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Creating category...                       โ
โ [Spinner] Please wait                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### Wireframe 6: FacturaUploadDialog (Drag-Drop XML)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Attach Factura (CFDI)                                      [ร] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ TRANSACTION                                                    โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ La Casa del Sabor                                        โ  โ
โ โ Oct 18, 2024 โข $500.00 MXN                               โ  โ
โ โ Santander Business                                       โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ UPLOAD FACTURA XML                                             โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ                                                          โ  โ
โ โ                         ๐                               โ  โ
โ โ                                                          โ  โ
โ โ              Drag and drop XML file here                 โ  โ
โ โ              or click to browse                          โ  โ
โ โ                                                          โ  โ
โ โ              Accepted: CFDI 3.3, CFDI 4.0 (.xml)         โ  โ
โ โ              Max size: 5MB                               โ  โ
โ โ                                                          โ  โ
โ โ  [Drag state: Normal - gray border, white background]   โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ โน๏ธ  WHAT'S A FACTURA?                                          โ
โ                                                                โ
โ A Factura (CFDI - Comprobante Fiscal Digital por Internet)    โ
โ is a Mexican tax receipt required by SAT for business          โ
โ expense deductions. Request from merchants at time of          โ
โ purchase.                                                      โ
โ                                                                โ
โ [Learn more about Facturas โ]                                  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ [Cancel]                                                       โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

DRAG STATES:

1. DRAG ENTER (file dragged over drop zone):
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ                                                          โ  โ
โ โ                         ๐โ                              โ  โ
โ โ                                                          โ  โ
โ โ              Drop XML file here                          โ  โ
โ โ                                                          โ  โ
โ โ  [Blue border (3px), light blue background (#E3F2FD)]   โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ

2. FILE SELECTED (via browse):
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ ๐ factura_abc123.xml (4.2 KB)                           โ  โ
โ โ                                                          โ  โ
โ โ [โโโโโโโโโโโโโโโโโโโโ] 100%                              โ  โ
โ โ Ready to upload                                          โ  โ
โ โ                                                          โ  โ
โ โ [Change File] [Upload]                                   โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ

3. UPLOADING:
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ ๐ factura_abc123.xml (4.2 KB)                           โ  โ
โ โ                                                          โ  โ
โ โ [โโโโโโโโโโโโโโโโโโโโ] 35%                               โ  โ
โ โ Uploading...                                             โ  โ
โ โ                                                          โ  โ
โ โ [Cancel Upload]                                          โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ

4. ERROR STATE:
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ โ Upload failed                                         โ  โ
โ โ                                                          โ  โ
โ โ Error: File too large (6.2 MB exceeds 5 MB limit)       โ  โ
โ โ                                                          โ  โ
โ โ [Try Again]                                              โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ

ACCESSIBILITY:
- Keyboard: Tab to drop zone, Space/Enter to open file picker
- Screen reader: "Factura upload area. Drag and drop XML file or press enter to browse"
- ARIA: role="button" aria-label="Upload Factura XML file"
```

---

### Wireframe 7: Factura Validation Feedback (RFC, UUID, Amount)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Attach Factura (CFDI)                                      [ร] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ TRANSACTION                                                    โ
โ La Casa del Sabor โข Oct 18, 2024 โข $500.00 MXN                โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ VALIDATION RESULTS                                             โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ ๐ factura_abc123.xml                                    โ  โ
โ โ                                                          โ  โ
โ โ FACTURA DETAILS                                          โ  โ
โ โ RFC:    ABC123456XYZ                                     โ  โ
โ โ UUID:   12345678-1234-1234-1234-123456789012             โ  โ
โ โ Issued: Oct 18, 2024                                     โ  โ
โ โ Amount: $500.00 MXN                                      โ  โ
โ โ                                                          โ  โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ  โ
โ โ VALIDATION STATUS                                        โ  โ
โ โ                                                          โ  โ
โ โ โ XML Format Valid (CFDI 4.0)                           โ  โ
โ โ โ RFC Format Valid (13 characters)                      โ  โ
โ โ โ UUID Format Valid (UUIDv4)                            โ  โ
โ โ โ UUID Verified with SAT Database                       โ  โ
โ โ โ Amount Matches Transaction ($500.00)                  โ  โ
โ โ โ Date Within Window (same day)                         โ  โ
โ โ โ Digital Signature Valid (Sello Digital)               โ  โ
โ โ                                                          โ  โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ  โ
โ โ STATUS: โ VALID - READY TO ATTACH                       โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ [Cancel]                                  [Attach Factura]    โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ERROR STATE (Multiple Issues):

โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ ๐ factura_invalid.xml                                   โ  โ
โ โ                                                          โ  โ
โ โ FACTURA DETAILS                                          โ  โ
โ โ RFC:    INVALID123                                       โ  โ
โ โ UUID:   not-a-valid-uuid                                 โ  โ
โ โ Issued: Oct 25, 2024                                     โ  โ
โ โ Amount: $520.00 MXN                                      โ  โ
โ โ                                                          โ  โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ  โ
โ โ VALIDATION STATUS                                        โ  โ
โ โ                                                          โ  โ
โ โ โ XML Format Valid (CFDI 4.0)                           โ  โ
โ โ โ RFC Format Invalid                                    โ  โ
โ โ    Expected: 12-13 alphanumeric characters               โ  โ
โ โ    Found: "INVALID123" (10 characters)                   โ  โ
โ โ โ UUID Format Invalid                                   โ  โ
โ โ    Expected: UUIDv4 format                               โ  โ
โ โ    Found: "not-a-valid-uuid"                             โ  โ
โ โ โ๏ธ  UUID Not Verified with SAT                           โ  โ
โ โ    (Skipped due to format error)                         โ  โ
โ โ โ๏ธ  Amount Mismatch                                      โ  โ
โ โ    Transaction: $500.00 MXN                              โ  โ
โ โ    Factura:     $520.00 MXN                              โ  โ
โ โ    Variance:    +$20.00 (4%)                             โ  โ
โ โ โ Date Outside Window                                   โ  โ
โ โ    Expected: Oct 18 ยฑ 7 days (Oct 11-25)                โ  โ
โ โ    Found: Oct 25 (7 days late)                           โ  โ
โ โ โ๏ธ  Digital Signature Not Verified                       โ  โ
โ โ    (Skipped due to other errors)                         โ  โ
โ โ                                                          โ  โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ  โ
โ โ STATUS: โ INVALID - CANNOT ATTACH                       โ  โ
โ โ                                                          โ  โ
โ โ โ Please verify this is a valid CFDI file from SAT.     โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ [Cancel]                              [Try Another File]       โ

WARNING STATE (Amount Mismatch within tolerance):

โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ ๐ factura_variance.xml                                  โ  โ
โ โ                                                          โ  โ
โ โ VALIDATION STATUS                                        โ  โ
โ โ                                                          โ  โ
โ โ โ XML Format Valid (CFDI 4.0)                           โ  โ
โ โ โ RFC Format Valid                                      โ  โ
โ โ โ UUID Verified with SAT                                โ  โ
โ โ โ๏ธ  Amount Mismatch (within tolerance)                   โ  โ
โ โ    Transaction: $500.00 MXN                              โ  โ
โ โ    Factura:     $520.00 MXN                              โ  โ
โ โ    Variance:    +$20.00 (4%)                             โ  โ
โ โ                                                          โ  โ
โ โ โ Possible reasons:                                      โ  โ
โ โ   โข Tips included in Factura                             โ  โ
โ โ   โข Separate tax/fee charges                             โ  โ
โ โ   โข Partial payment (transaction split)                  โ  โ
โ โ                                                          โ  โ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ            โ  โ
โ โ STATUS: โ๏ธ  VALID WITH WARNINGS                          โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ [Cancel]  [Adjust Transaction]  [Force Link Anyway]            โ
```

---

### Wireframe 8: Bulk Classification Dialog (Multi-Select)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Bulk Classify Transactions                                 [ร] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ You're about to classify 8 transactions                        โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ SELECTED TRANSACTIONS                                          โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ Oct 23  Starbucks           -$5.75    [ร]                โ  โ
โ โ Oct 21  Starbucks           -$4.25    [ร]                โ  โ
โ โ Oct 19  Starbucks           -$6.50    [ร]                โ  โ
โ โ Oct 18  Starbucks           -$5.00    [ร]                โ  โ
โ โ Oct 16  Starbucks           -$7.25    [ร]                โ  โ
โ โ Oct 14  Starbucks           -$4.75    [ร]                โ  โ
โ โ Oct 12  Starbucks           -$5.50    [ร]                โ  โ
โ โ Oct 10  Starbucks           -$6.00    [ร]                โ  โ
โ โ                                                          โ  โ
โ โ Total Amount: -$45.00                                    โ  โ
โ โ Date Range: Oct 10 - Oct 23, 2024                        โ  โ
โ โ                                                          โ  โ
โ โ [ร] = Remove from selection                              โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ APPLY TAX CATEGORY                                             โ
โ                                                                โ
โ Tax Category *                                                 โ
โ [Meals (Business) โข 50% deductible_______________] ๐          โ
โ                                                                โ
โ Jurisdiction: USA Federal (all transactions)                   โ
โ โ All transactions are in the same jurisdiction               โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ CLASSIFICATION NOTES (optional)                                โ
โ                                                                โ
โ [Client meetings at local Starbucks_____________________]      โ
โ [_______________________________________________________]      โ
โ                                                                โ
โ โ These notes will be applied to all 8 transactions           โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ SUMMARY                                                        โ
โ                                                                โ
โ Category: Meals (Business) โข Schedule C Line 24b               โ
โ Deduction Rate: 50% (partially deductible)                     โ
โ Total Deductible: $22.50 (50% of $45.00)                      โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ [Cancel]                                  [Classify All 8 โ]   โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

PROGRESS STATE (during classification):

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Classifying Transactions...                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ [โโโโโโโโโโโโโโโโโโโโโโ] 8 of 8 (100%)                         โ
โ                                                                โ
โ โ Oct 23  Starbucks           -$5.75                          โ
โ โ Oct 21  Starbucks           -$4.25                          โ
โ โ Oct 19  Starbucks           -$6.50                          โ
โ โ Oct 18  Starbucks           -$5.00                          โ
โ โ Oct 16  Starbucks           -$7.25                          โ
โ โ Oct 14  Starbucks           -$4.75                          โ
โ โ Oct 12  Starbucks           -$5.50                          โ
โ โ Oct 10  Starbucks           -$6.00                          โ
โ                                                                โ
โ Processing complete! Closing in 2 seconds...                   โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ERROR STATE (mixed jurisdictions):

โ โ๏ธ  VALIDATION ERROR                                           โ
โ                                                                โ
โ Selected transactions have mixed jurisdictions:                โ
โ                                                                โ
โ โข 5 transactions: USA Federal                                  โ
โ โข 3 transactions: Mexico Federal                               โ
โ                                                                โ
โ โ You can only bulk classify transactions from the same       โ
โ   jurisdiction. Please select one group:                       โ
โ                                                                โ
โ [Classify USA (5 transactions)]                                โ
โ [Classify Mexico (3 transactions)]                             โ
โ [Cancel]                                                       โ
```

---

### Wireframe 9: Tax Summary Widget (Dashboard)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Tax Summary - 2024                              [View Full โ]  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ TOTAL DEDUCTIONS                                               โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ $42,850.00                                               โ  โ
โ โ 87% of transactions categorized                          โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ BY JURISDICTION                                                โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ ๐บ๐ธ USA Federal                           $38,200.00     โ  โ
โ โ Schedule C โข 142 transactions                            โ  โ
โ โ [โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ] 89% categorized         โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ ๐ฒ๐ฝ Mexico Federal                         $4,650.00     โ  โ
โ โ SAT โข 23 transactions                                    โ  โ
โ โ [โโโโโโโโโโโโโโโโโโโโโโโโโโโ] 78% categorized            โ  โ
โ โ โ๏ธ  5 transactions missing Facturas                      โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ TOP DEDUCTION CATEGORIES (USA)                                 โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ 1. Travel                              $12,450.00   29%  โ  โ
โ โ    [โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ]     โ  โ
โ โ    45 transactions โข 100% deductible                     โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ 2. Office Expenses                      $8,920.00   21%  โ  โ
โ โ    [โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ]     โ  โ
โ โ    32 transactions โข 100% deductible                     โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ 3. Meals (Business)                     $3,280.00    8%  โ  โ
โ โ    [โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ]     โ  โ
โ โ    28 transactions โข 50% deductible ($1,640 actual)      โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ 4. Advertising                          $7,100.00   17%  โ  โ
โ โ    [โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ]     โ  โ
โ โ    18 transactions โข 100% deductible                     โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ 5. Utilities                            $6,450.00   15%  โ  โ
โ โ    [โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ]     โ  โ
โ โ    19 transactions โข 100% deductible                     โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ [View All Categories โ]                                        โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ UNCATEGORIZED TRANSACTIONS                                     โ
โ                                                                โ
โ โ๏ธ  23 transactions not categorized ($3,120.00)                โ
โ [Categorize Now โ]                                             โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ ACTIONS                                                        โ
โ [Export Tax Report] [View by Month] [Settings]                โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

INTERACTION:
- Click category: View all transactions in that category
- Click jurisdiction: Filter to USA or Mexico transactions
- Click "View Full": Navigate to detailed tax report page
- Hover bars: Tooltip with exact amounts and percentages

RESPONSIVE:
- Desktop: Full width widget (2 column layout)
- Tablet: Single column, stacked sections
- Mobile: Compact view with collapsible sections

EMPTY STATE (no categorized transactions):
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Tax Summary - 2024                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                โ
โ No transactions categorized yet                โ
โ                                                โ
โ Start categorizing transactions to track       โ
โ deductible expenses and maintain tax records.  โ
โ                                                โ
โ [Categorize Transactions]                      โ
โ                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### Wireframe 10: Multi-Jurisdiction Switching (USA โ Mexico)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Transaction Details                                        [ร] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ Amazon Web Services                                            โ
โ Oct 22, 2024                                                   โ
โ                                                                โ
โ Amount: -$89.50 USD                                            โ
โ Account: Chase Business Credit (USA)                           โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ TAX CLASSIFICATION                                             โ
โ                                                                โ
โ โช Not categorized yet                                         โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ JURISDICTION SELECTOR                                    โ  โ
โ โ                                                          โ  โ
โ โ Primary Jurisdiction: [USA Federal โผ]                    โ  โ
โ โ                                                          โ  โ
โ โ Auto-detected from account country                       โ  โ
โ โ                                                          โ  โ
โ โ Available Jurisdictions:                                 โ  โ
โ โ โฆฟ ๐บ๐ธ USA Federal (Schedule C)                           โ  โ
โ โ โ ๐ฒ๐ฝ Mexico Federal (SAT)                               โ  โ
โ โ                                                          โ  โ
โ โ โ Select jurisdiction to view appropriate tax           โ  โ
โ โ   categories and compliance requirements                 โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ [Categorize with USA Federal Categories]                       โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ FACTURA (CFDI)                                                 โ
โ ๐ Not applicable (USA transaction)                            โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

SWITCHED TO MEXICO:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Transaction Details                                        [ร] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ Restaurante El Patio                                           โ
โ Oct 22, 2024                                                   โ
โ                                                                โ
โ Amount: -$850.00 MXN                                           โ
โ Account: Santander Business (Mexico)                           โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ TAX CLASSIFICATION                                             โ
โ                                                                โ
โ โช Not categorized yet                                         โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ JURISDICTION SELECTOR                                    โ  โ
โ โ                                                          โ  โ
โ โ Primary Jurisdiction: [Mexico Federal โผ]                 โ  โ
โ โ                                                          โ  โ
โ โ Auto-detected from account country                       โ  โ
โ โ                                                          โ  โ
โ โ Available Jurisdictions:                                 โ  โ
โ โ โ ๐บ๐ธ USA Federal (Schedule C)                           โ  โ
โ โ โฆฟ ๐ฒ๐ฝ Mexico Federal (SAT)                               โ  โ
โ โ                                                          โ  โ
โ โ โ Select jurisdiction to view appropriate tax           โ  โ
โ โ   categories and compliance requirements                 โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โ [Categorize with Mexico SAT Categories]                        โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ FACTURA (CFDI)                                                 โ
โ ๐ No Factura attached                                         โ
โ                                                                โ
โ โน๏ธ  Factura required for SAT compliance                        โ
โ [Attach Factura XML]                                           โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

CROSS-BORDER WARNING:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Transaction Details                                        [ร] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ Airbnb (Mexico City)                                           โ
โ Oct 22, 2024                                                   โ
โ                                                                โ
โ Amount: -$125.00 USD                                           โ
โ Account: Chase Business Credit (USA)                           โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ TAX CLASSIFICATION                                             โ
โ                                                                โ
โ โช Not categorized yet                                         โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ โ JURISDICTION SELECTOR                                    โ  โ
โ โ                                                          โ  โ
โ โ Primary Jurisdiction: [Mexico Federal โผ]                 โ  โ
โ โ                                                          โ  โ
โ โ โ๏ธ  CROSS-BORDER TRANSACTION DETECTED                    โ  โ
โ โ                                                          โ  โ
โ โ Account: USA (Chase Business Credit)                     โ  โ
โ โ Selected Jurisdiction: Mexico Federal                    โ  โ
โ โ                                                          โ  โ
โ โ โ This is a USA account transaction being classified    โ  โ
โ โ   under Mexico tax law. This may affect tax filings.     โ  โ
โ โ                                                          โ  โ
โ โ Recommended: Use USA Federal jurisdiction unless you     โ  โ
โ โ have specific cross-border tax requirements.             โ  โ
โ โ                                                          โ  โ
โ โ [Switch to USA Federal] [Continue with Mexico]           โ  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

INTERACTION:
- Jurisdiction auto-detected from account.country
- User can override jurisdiction (shows warning if mismatch)
- Category selector updates based on selected jurisdiction
- Factura fields shown/hidden based on jurisdiction (Mexico only)

KEYBOARD:
- Tab: Navigate jurisdiction options
- Arrow keys: Select jurisdiction
- Enter: Confirm selection
```

---

## Additional UX Considerations

### Loading States

**Category Selector Loading:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Tax Category                               [ร] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                โ
โ Loading categories...                          โ
โ [Spinner animation]                            โ
โ                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**Auto-Suggestion Checking:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ก Checking for suggestions...                 โ
โ [Spinner] Please wait                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**Factura Validation Processing:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Validating Factura...                          โ
โ [โโโโโโโโโโโโโโโโโโโโ] 60%                     โ
โ โ XML parsed                                  โ
โ โณ Validating with SAT...                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### Empty States

**No Custom Categories:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              No custom categories              โ
โ                                                โ
โ         Create custom categories to            โ
โ      track expenses specific to your           โ
โ              business needs.                   โ
โ                                                โ
โ      [+ Create First Custom Category]          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**No Uncategorized Transactions:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              All caught up!                    โ
โ                                                โ
โ      All transactions are categorized.         โ
โ         Great work on maintaining              โ
โ           tax compliance records!              โ
โ                                                โ
โ          [View Tax Summary โ]                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### Error States

**Network Error During Category Load:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ Failed to load categories                   โ
โ                                                โ
โ Unable to connect to server.                   โ
โ Please check your internet connection.         โ
โ                                                โ
โ [Retry] [Use Cached Categories]                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**SAT Validation Service Down:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ  SAT validation service unavailable         โ
โ                                                โ
โ Factura XML format validated successfully,     โ
โ but unable to verify UUID with SAT database.   โ
โ                                                โ
โ [Attach Anyway] [Try Again Later] [Cancel]     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**Bulk Classification Partial Failure:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ๏ธ  Partial Success                            โ
โ                                                โ
โ โ 6 of 8 transactions classified              โ
โ โ 2 transactions failed                       โ
โ                                                โ
โ Failed transactions:                           โ
โ โข Oct 12 Starbucks -$5.50 (already classified) โ
โ โข Oct 10 Starbucks -$6.00 (transaction locked) โ
โ                                                โ
โ [View Failed Transactions] [Done]              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### Accessibility Features

**Screen Reader Announcements:**
- "Tax category selector opened. USA Federal Schedule C categories loaded. 25 categories available."
- "Auto-suggestion: Travel, Ground Transportation. Confidence 95%, very high."
- "Factura validation complete. All checks passed. Ready to attach."
- "Bulk classification: 8 of 8 transactions classified successfully."

**Keyboard Shortcuts:**
- `C`: Open category selector (when transaction detail focused)
- `F`: Attach Factura (Mexico transactions only)
- `Escape`: Close modal/drawer
- `Enter`: Confirm selection
- `Arrow keys`: Navigate lists and trees
- `Tab`: Move between fields
- `Space`: Expand/collapse tree nodes

**Focus Management:**
- Auto-focus on search field when category selector opens
- Return focus to trigger button when modal closes
- Trap focus within modal (Tab cycles through modal elements only)
- Clear focus indicators (2px blue outline on focused elements)

**Color Contrast:**
- All text meets WCAG AA standards (4.5:1 for normal, 3:1 for large)
- Badge colors: Green #059669 (100%), Yellow #D97706 (50%), Gray #6B7280 (0%)
- Error red: #DC2626, Warning yellow: #F59E0B, Success green: #10B981

**ARIA Labels:**
- `role="dialog"` for modals
- `aria-label="Tax category selector"` on dropdowns
- `aria-live="polite"` for success toasts
- `aria-live="assertive"` for error messages
- `aria-describedby` linking fields to help text

---

## Notes

**Design System Alignment:**
- Uses 8px grid system (padding/margin: 8px, 16px, 24px, 32px)
- Typography: System font stack (SF Pro, Segoe UI, Roboto)
- Headings: 24px (H1), 20px (H2), 16px (H3), 14px (body), 12px (small)
- Border radius: 8px (cards), 6px (buttons), 4px (inputs)
- Shadows: 0 1px 3px rgba(0,0,0,0.1) (cards), 0 4px 6px rgba(0,0,0,0.1) (modals)

**Performance:**
- Category selector: Lazy load custom categories (load on demand)
- Search: Debounce 300ms to avoid excessive filtering
- Bulk classification: Batch API calls (max 50 transactions per batch)
- Factura upload: Chunk large files (1MB chunks for files >5MB)

**Mobile Considerations:**
- Touch targets: Minimum 44x44px for all interactive elements
- Bottom sheets: Modals slide from bottom on mobile (<768px)
- Simplified bulk selection: Long-press to enter selection mode
- Sticky headers: Keep jurisdiction selector visible while scrolling

---

**File:** `/Users/darwinborges/Description/docs/ux-flows/3.4-tax-categorization-experience.md`
**Lines:** 1,232
**Status:** Complete with 6 user journeys, 10 wireframes, accessibility features, and responsive design notes.
