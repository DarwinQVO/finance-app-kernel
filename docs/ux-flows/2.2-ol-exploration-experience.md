# UX Flow 2.2: OL Exploration Experience

> **Vertical:** 2.2 OL Exploration (drill-down, decisions, provenance)
> **Dependencies:** 2.1 Transaction List View (provides entry point)
> **User Story:** As a user, I want to drill down into a transaction to see its complete lineage, understand normalization decisions, and access the original document.

---

## User Journeys

### Journey 1: Verify Categorization

**Context:** User reviews monthly transactions and wants to understand why a transaction was categorized as "Personal" when it should be "Business".

**Steps:**

1. **Entry point:** User is on Transaction List View (vertical 2.1)
   - Sees table with 50 transactions
   - Spots "Aeromexico 4,516 MXN | Personal > Travel > Flights"
   - Thinks: "¿Por qué Personal? Ese viaje fue para reunión con cliente"

2. **Open drill-down:**
   - User clicks transaction row
   - Drill-down panel slides in from right (desktop) or opens full-screen (mobile)
   - Loading skeleton shows while data fetches (~500ms)

3. **Overview tab (default):**
   - User sees:
     ```
     Canonical Data
     ├─ Date: 2025-04-26
     ├─ Merchant: Aeromexico
     ├─ Amount: 4,516.00 MXN ($231.78 USD)
     ├─ Category: Personal > Travel > Flights
     └─ Confidence: 87%

     Normalization Decisions
     ┌─────────────────────────────────────────┐
     │ Merchant                                │
     │ Normalized 'AEROMEXICO MEX' → 'Aeromexico' │
     │ Rule: merchant_normalization_v1.2       │
     │ Confidence: 95%                         │
     └─────────────────────────────────────────┘

     ┌─────────────────────────────────────────┐
     │ Category                                │
     │ Categorized as 'Personal > Travel > Flights' │
     │ Rule: merchant='aeromexico' → Travel    │
     │ Confidence: 87%                         │
     │ Alternatives:                           │
     │   - Business > Travel (rejected: no business keywords) │
     └─────────────────────────────────────────┘
     ```

4. **User understanding:**
   - User sees: System auto-categorized based on merchant pattern
   - User realizes: No business keywords detected (no hotel, no meeting, etc.)
   - User decides: "Need to flag this for manual correction" (action deferred to vertical 4.3)

5. **Close drill-down:**
   - User presses ESC or clicks X button
   - Panel slides out
   - Returns to transaction list view

**Outcome:** User understands WHY categorization happened and knows how to fix it.

**Duration:** ~30 seconds

---

### Journey 2: Investigate Parsing Issue

**Context:** User sees transaction with $0.00 amount (unexpected). Drills down to investigate.

**Steps:**

1. **Entry point:** Transaction list shows "HubSpot Inc $0.00 USD" (red flag)

2. **Open drill-down:** User clicks row → Panel opens

3. **Overview tab:**
   - Canonical amount: $0.00
   - Confidence: 34% (LOW - red indicator)
   - User sees warning: "⚠ Amount confidence low"

4. **Switch to Raw Data tab:**
   - User clicks "Raw Data" tab
   - Sees side-by-side comparison:
     ```
     ┌─────────────────┬──────────────────┐
     │ Observation     │ Canonical        │
     ├─────────────────┼──────────────────┤
     │ date_raw:       │ transaction_date:│
     │ "04/30/2025"    │ "2025-04-30"     │
     │                 │                  │
     │ merchant_raw:   │ merchant:        │
     │ "HUBSPOT INC"   │ "HubSpot Inc"    │
     │                 │                  │
     │ amount_raw:     │ amount:          │
     │ "N/A"   (red!)  │ 0.00 (red!)      │
     └─────────────────┴──────────────────┘
     ```
   - User sees: Parser couldn't extract amount ("N/A")

5. **Switch to Provenance tab:**
   - Timeline shows:
     ```
     📤 Uploaded
     User: eugenio@example.com
     2025-04-30 10:00:00
           ↓ 15s
     🔍 Parsed
     System: bofa_pdf_parser_v1.2
     2025-04-30 10:00:15
     ⚠ Warning: Amount field empty in PDF row 47
           ↓ 3s
     ✓ Normalized
     System: normalizer_v1.0
     2025-04-30 10:00:18
     Defaulted amount to 0.00 (missing value)
     ```
   - User sees: Parse log shows warning about empty amount field

6. **Switch to Artifact tab:**
   - User clicks "Artifact" tab
   - PDF viewer loads: bofa_statement_2025-04.pdf
   - User clicks "Jump to row 47" (if supported)
   - PDF shows page 3, row 47: Amount is "$5,000" but scanned image (not text)
   - User understands: Parser can't read scanned images

7. **User decision:**
   - User notes: "Need to manually enter amount = $5,000"
   - User closes panel
   - User flags transaction for correction (vertical 4.3)

**Outcome:** User identified root cause (scanned image) and knows how to fix it.

**Duration:** ~2 minutes

---

### Journey 3: Audit Trail for Accountant

**Context:** User needs to prove transaction source to CPA (tax audit).

**Steps:**

1. **Entry point:** Accountant asks: "Can you prove the HubSpot $5,000 payment came from your bank statement?"

2. **Open drill-down:** User finds transaction, clicks row

3. **Overview tab:**
   - User sees canonical data: "HubSpot Inc $5,000 USD | 2025-04-30"

4. **Switch to Provenance tab:**
   - User sees audit trail:
     ```
     📤 Uploaded
     User: eugenio@example.com
     IP: 192.168.1.100
     2025-05-01 10:30:00
           ↓
     🔍 Parsed
     System: bofa_pdf_parser_v1.2
     Observations extracted: 47
           ↓
     ✓ Normalized
     System: normalizer_v1.0
     Confidence: 98%
     ```
   - User sees: Uploaded on May 1st, parsed successfully

5. **Switch to Artifact tab:**
   - User sees metadata:
     ```
     File: bofa_statement_2025-04.pdf
     Size: 245KB
     Uploaded by: eugenio@example.com
     Uploaded at: 2025-05-01 10:30:00
     Hash (SHA-256): a3b5c7d9e1f...
     ```
   - User clicks "Download PDF"
   - Original statement downloads

6. **User action:**
   - User emails PDF to accountant
   - User includes provenance info: "Uploaded May 1st, hash: a3b5c7d9e1f... for verification"

**Outcome:** User provided verifiable proof of transaction source.

**Duration:** ~1 minute

---

### Journey 4: Compare Raw vs Canonical (Learning)

**Context:** User wants to understand how raw data becomes canonical (educational).

**Steps:**

1. **Open drill-down:** User clicks any transaction

2. **Switch to Raw Data tab immediately:**
   - User sees field comparison table:
     ```
     ┌─────────────────────┬────────────────────┐
     │ Observation (Raw)   │ Canonical (Clean)  │
     ├─────────────────────┼────────────────────┤
     │ date_raw:           │ transaction_date:  │
     │ "04/26/2025"        │ "2025-04-26"       │
     │ (MM/DD/YYYY)        │ (ISO 8601)         │
     ├─────────────────────┼────────────────────┤
     │ merchant_raw:       │ merchant:          │
     │ "UBER EATS PENDING" │ "Uber Eats"        │
     │ (all caps, noise)   │ (normalized)       │
     ├─────────────────────┼────────────────────┤
     │ amount_raw:         │ amount:            │
     │ "$68.06 USD"        │ 68.06              │
     │ (with symbols)      │ (decimal only)     │
     └─────────────────────┴────────────────────┘
     ```

3. **User learning:**
   - User sees transformation: "UBER EATS PENDING" → "Uber Eats"
   - User sees date standardization: MM/DD/YYYY → ISO 8601
   - User sees amount cleaning: "$68.06 USD" → 68.06 (number)

4. **User clicks on decision card (in Overview tab):**
   - Expands merchant decision:
     ```
     ┌────────────────────────────────────────────┐
     │ Merchant                                   │
     │ Decision: Normalized 'UBER EATS PENDING' → 'Uber Eats' │
     │ Rule: merchant_normalization_v1.2          │
     │ Pattern: Remove trailing status words       │
     │           (PENDING, AUTHORIZED, etc.)       │
     │ Confidence: 95%                            │
     │ Alternatives considered:                   │
     │   - "Uber Eats Pending" (rejected: redundant) │
     │   - "UBER EATS" (rejected: all caps)       │
     └────────────────────────────────────────────┘
     ```

5. **User understanding:**
   - User learns: System removes noise words ("PENDING")
   - User learns: System normalizes capitalization
   - User builds mental model of normalization process

**Outcome:** User understands truth construction pipeline.

**Duration:** ~3 minutes

---

## Wireframes

### Desktop: Drill-Down Panel (Slide-in from right)

```
┌──────────────────────────────────────────────────────────────────────────┐
│ Transaction List View                                                    │
├──────────────────────────────────────────────────────────────────────────┤
│ Date       Merchant        Amount      Category              ✓          │
│ 05/23      Uber Eats       $68.06      Food                              │
│ 05/22      GNC             $42.56      Health                            │
│ 04/26      Aeromexico   4,516.00 MXN   Personal > Travel → [CLICKED]    │
└──────────────────────────────────────────────────────────────────────────┘
                                          ┌─────────────────────────────────┐
                                          │ ✕  Transaction Details          │
                                          ├─────────────────────────────────┤
                                          │ [Overview] Raw Data Provenance  │
                                          │                    Artifact     │
                                          ├─────────────────────────────────┤
                                          │ Canonical Data                  │
                                          │ Date: 2025-04-26                │
                                          │ Merchant: Aeromexico            │
                                          │ Amount: 4,516 MXN ($231.78)     │
                                          │ Category: Personal > Travel     │
                                          │ Confidence: 87%                 │
                                          │                                 │
                                          │ Normalization Decisions         │
                                          │ ┌─────────────────────────────┐ │
                                          │ │ Merchant                    │ │
                                          │ │ 'AEROMEXICO MEX' → 'Aeromexico' │
                                          │ │ Rule: merchant_norm_v1.2    │ │
                                          │ │ Confidence: 95%             │ │
                                          │ └─────────────────────────────┘ │
                                          │ ┌─────────────────────────────┐ │
                                          │ │ Category                    │ │
                                          │ │ 'Personal > Travel > Flights' │
                                          │ │ Rule: merchant='aeromexico' │ │
                                          │ │ Confidence: 87%             │ │
                                          │ └─────────────────────────────┘ │
                                          │                                 │
                                          │ [Close]   [Flag for Review]     │
                                          └─────────────────────────────────┘
```

---

### Mobile: Drill-Down Full-Screen

```
┌──────────────────────────┐
│ ←  Transaction Details   │
├──────────────────────────┤
│ [Overview] Raw Data      │
│ Provenance Artifact      │
├──────────────────────────┤
│                          │
│ Canonical Data           │
│                          │
│ Date                     │
│ 2025-04-26               │
│                          │
│ Merchant                 │
│ Aeromexico               │
│                          │
│ Amount                   │
│ 4,516 MXN ($231.78)      │
│                          │
│ Category                 │
│ Personal > Travel        │
│                          │
│ Confidence: 87%          │
│                          │
│ ─────────────────────    │
│                          │
│ Normalization Decisions  │
│                          │
│ ┌──────────────────────┐ │
│ │ Merchant             │ │
│ │ 'AEROMEXICO MEX'     │ │
│ │ → 'Aeromexico'       │ │
│ │ Confidence: 95%      │ │
│ └──────────────────────┘ │
│                          │
│ (scroll for more)        │
│                          │
│ [Flag for Review]        │
└──────────────────────────┘
```

---

### Raw Data Tab (Side-by-Side Comparison)

```
┌──────────────────────────────────────────────────────────────┐
│ ✕  Transaction Details - Raw Data Tab                        │
├──────────────────────────────────────────────────────────────┤
│ Overview [Raw Data] Provenance Artifact                      │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│ Field Comparison (Observation → Canonical)                  │
│                                                              │
│ ┌───────────────────────┬────────────────────────────────┐  │
│ │ Observation (Raw)     │ Canonical (Normalized)         │  │
│ ├───────────────────────┼────────────────────────────────┤  │
│ │ date_raw              │ transaction_date               │  │
│ │ "04/26/2025"          │ "2025-04-26"                   │  │
│ │ (MM/DD/YYYY)          │ (ISO 8601)                     │  │
│ ├───────────────────────┼────────────────────────────────┤  │
│ │ merchant_raw          │ merchant                       │  │
│ │ "AEROMEXICO MEX"      │ "Aeromexico"                   │  │
│ │                       │ (normalized capitalization)    │  │
│ ├───────────────────────┼────────────────────────────────┤  │
│ │ amount_raw            │ amount                         │  │
│ │ "4,516.00 MXN"        │ 4516.00                        │  │
│ │                       │ (parsed decimal)               │  │
│ ├───────────────────────┼────────────────────────────────┤  │
│ │ (no category in raw)  │ category                       │  │
│ │                       │ "Personal > Travel > Flights"  │  │
│ │                       │ (inferred from merchant)       │  │
│ └───────────────────────┴────────────────────────────────┘  │
│                                                              │
│ [Close]                                                      │
└──────────────────────────────────────────────────────────────┘
```

---

### Provenance Tab (Timeline)

```
┌──────────────────────────────────────────────────────────────┐
│ ✕  Transaction Details - Provenance Tab                      │
├──────────────────────────────────────────────────────────────┤
│ Overview Raw Data [Provenance] Artifact                      │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│ Audit Trail                                                  │
│                                                              │
│ ┌───────────────────────────────────────────────────────┐   │
│ │ 📤 Uploaded                                           │   │
│ │ User: eugenio@example.com                             │   │
│ │ IP: 192.168.1.100                                     │   │
│ │ 2 hours ago (2025-04-27 10:29:30)                     │   │
│ └───────────────────────────────────────────────────────┘   │
│         ↓ 15s                                                │
│ ┌───────────────────────────────────────────────────────┐   │
│ │ 🔍 Parsed                                             │   │
│ │ System: bofa_pdf_parser_v1.2                          │   │
│ │ Observations extracted: 47                            │   │
│ │ Errors: 0 | Warnings: 2                               │   │
│ │ 2 hours ago (2025-04-27 10:29:45)                     │   │
│ │ [Click to expand metadata]                            │   │
│ └───────────────────────────────────────────────────────┘   │
│         ↓ 3s                                                 │
│ ┌───────────────────────────────────────────────────────┐   │
│ │ ✓ Normalized                                          │   │
│ │ System: normalizer_v1.0                               │   │
│ │ Rules applied: 5                                      │   │
│ │ Validations passed: 7                                 │   │
│ │ Confidence: 87%                                       │   │
│ │ 2 hours ago (2025-04-27 10:30:00)                     │   │
│ └───────────────────────────────────────────────────────┘   │
│                                                              │
│ Execution Logs                                               │
│ • Parse Log →                                                │
│ • Normalization Log →                                        │
│                                                              │
│ [Close]                                                      │
└──────────────────────────────────────────────────────────────┘
```

---

### Artifact Tab (PDF Viewer)

```
┌──────────────────────────────────────────────────────────────┐
│ ✕  Transaction Details - Artifact Tab                        │
├──────────────────────────────────────────────────────────────┤
│ Overview Raw Data Provenance [Artifact]                      │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│ File Information                                             │
│ Filename: apple_card_statement_2025-04.pdf                   │
│ Size: 245 KB                                                 │
│ Uploaded by: eugenio@example.com                             │
│ Uploaded at: 2025-04-27 10:29:30                             │
│ Hash: a3b5c7d9e1f...                                         │
│                                                              │
│ ───────────────────────────────────────────────────────────  │
│                                                              │
│ Preview                                                      │
│ ┌──────────────────────────────────────────────────────┐    │
│ │                                                      │    │
│ │  [PDF Viewer - Page 2/5]                            │    │
│ │                                                      │    │
│ │  Statement Period: April 1-30, 2025                 │    │
│ │                                                      │    │
│ │  Transaction Date    Merchant          Amount       │    │
│ │  04/26/2025         AEROMEXICO MEX    4,516.00 MXN  │  ← Highlighted
│ │                                                      │    │
│ │  [< Prev]   Page 2 of 5   [Next >]                  │    │
│ │                                                      │    │
│ └──────────────────────────────────────────────────────┘    │
│                                                              │
│ [Download PDF]                                               │
│                                                              │
│ [Close]                                                      │
└──────────────────────────────────────────────────────────────┘
```

---

## UI States

### Loading State (Skeleton)

```
┌─────────────────────────────────┐
│ ✕  Transaction Details          │
├─────────────────────────────────┤
│ [Overview] Raw Data Provenance  │
├─────────────────────────────────┤
│ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓            │
│ ▓▓▓▓▓▓▓▓▓▓▓▓                    │
│ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                │
│                                 │
│ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓            │
│ ▓▓▓▓▓▓▓▓▓▓▓▓                    │
│ ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                │
└─────────────────────────────────┘
```

### Error State (Transaction Not Found)

```
┌─────────────────────────────────┐
│ ✕  Transaction Details          │
├─────────────────────────────────┤
│                                 │
│      ⚠                          │
│  Transaction Not Found          │
│                                 │
│  The transaction you requested  │
│  could not be found.            │
│                                 │
│  [Back to List]                 │
│                                 │
└─────────────────────────────────┘
```

### Empty State (Observation Missing)

```
┌─────────────────────────────────┐
│ ✕  Transaction Details - Raw    │
├─────────────────────────────────┤
│ Overview [Raw Data] Provenance  │
├─────────────────────────────────┤
│                                 │
│      ℹ                          │
│  Raw Observation Unavailable    │
│                                 │
│  The raw observation data for   │
│  this transaction is missing    │
│  (parse error).                 │
│                                 │
│  Showing canonical data only.   │
│                                 │
│  [Switch to Overview Tab]       │
│                                 │
└─────────────────────────────────┘
```

### Deleted Artifact State

```
┌─────────────────────────────────┐
│ ✕  Transaction Details - Artifact │
├─────────────────────────────────┤
│ Overview Raw Data [Artifact]    │
├─────────────────────────────────┤
│                                 │
│      🗑                          │
│  File Deleted                   │
│                                 │
│  Original file deleted on:      │
│  2025-06-01 00:00:00            │
│                                 │
│  Retention policy: 30 days      │
│  post-normalization             │
│                                 │
│  Hash (for audit):              │
│  a3b5c7d9e1f...                 │
│                                 │
└─────────────────────────────────┘
```

---

## Interaction Details

### Opening Drill-Down

**Desktop:**
- Click transaction row → Panel slides in from right (300ms animation)
- Panel width: 600px (40% of screen)
- Main view remains visible (60% left)
- Overlay dim: 20% black behind panel

**Mobile:**
- Tap transaction row → Full-screen slide up (300ms animation)
- Back button (←) appears in top-left
- No overlay (full-screen)

**Keyboard:**
- `Enter` on focused row → Opens drill-down
- `ESC` → Closes drill-down

---

### Tab Switching

**Click tab:**
- Tab becomes active (bold, underline)
- Content animates in (fade 200ms)

**Keyboard:**
- `→` arrow → Next tab
- `←` arrow → Previous tab

**Mobile swipe:**
- Swipe left/right → Switch tabs (like Instagram stories)

---

### Decision Card Expansion

**Default:** Collapsed (shows summary only)
**Click card:** Expands to show full details (metadata, alternatives, confidence breakdown)
**Click again:** Collapses back to summary

```
Collapsed:
┌─────────────────────────────────┐
│ Merchant                        │
│ 'UBER EATS' → 'Uber Eats'       │
│ Confidence: 95%                 │
└─────────────────────────────────┘

Expanded:
┌─────────────────────────────────┐
│ Merchant                        │
│ Decision: Normalized 'UBER EATS PENDING' → 'Uber Eats' │
│ Rule: merchant_normalization_v1.2 │
│ Pattern: Remove status words    │
│ Confidence: 95%                 │
│ Alternatives:                   │
│   - "Uber Eats Pending" (rejected) │
│   - "UBER EATS" (rejected)      │
└─────────────────────────────────┘
```

---

### PDF Viewer Interactions

**Open:** Click "Artifact" tab → PDF loads in iframe (or fallback component)

**Navigation:**
- `[< Prev]` / `[Next >]` buttons → Navigate pages
- Page number dropdown → Jump to specific page
- Scroll → Continuous scroll (if supported by viewer)

**Highlight:** If observation has `location.page` and `location.row`, auto-scroll to that row and highlight (yellow background)

**Download:** Click "Download PDF" → Opens in new tab or downloads (based on browser)

---

### Accessibility

**Screen Reader:**
- Announces: "Drill-down panel opened for transaction Aeromexico 4,516 MXN"
- Reads tabs: "Overview tab, selected. 4 tabs available."
- Reads decisions: "Merchant decision: Normalized UBER EATS to Uber Eats, confidence 95%"

**Keyboard Navigation:**
- `Tab` → Focus next element
- `Shift+Tab` → Focus previous element
- `ESC` → Close panel
- `→` / `←` → Switch tabs
- `Enter` / `Space` → Expand decision card, activate button

**High Contrast:**
- Decision cards have borders (not just background color)
- Confidence scores show icons (not just color):
  - 90-100%: ✓ (green)
  - 70-89%: ⚠ (yellow)
  - <70%: ⚠ (red)

---

## Performance Expectations

| Action | Target | Notes |
|--------|--------|-------|
| Open drill-down | p95 < 1s | Includes API call + render |
| Switch tabs | < 100ms | Client-side, no API call |
| Expand decision card | < 50ms | Pure UI, no API call |
| Load PDF viewer | p95 < 3s | Depends on file size |

---

**Next vertical:** 2.3 (Finance Dashboard) — Saved views, pre-configured metrics, snapshot exports.
